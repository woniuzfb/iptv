<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="hbo.png">
    <link href="https://cdn.bootcss.com/video.js/7.6.6/video-js.min.css" rel="stylesheet">
    <style>
html { 
  font-size: 62.5%;
}

a {
  color: #70B7FD;
  text-decoration: none;
}

li {
  margin-left: .8rem;
  list-style: none;
}

ul:focus, li:focus {
  outline: none;
}

button {
  font-size: 1.44rem;
}

input {
  display: inline-block;
  text-align: center;
  font-size: 1.6rem;
  border-radius: .1rem;
  box-sizing: border-box;
  height: 3.2rem;
  max-width: 12.8rem;
}

body {
  width: 95%;
  margin: 0 auto;
  font: 1.6rem/1.2 'PingFangSC','helvetica neue','hiragino sans gb','arial','microsoft yahei ui','microsoft yahei','simsun','sans-serif';
  display: grid;
  grid-template-columns: 1fr 8fr;
  grid-gap: 2rem;
}

header {
  grid-column: 1 / 9;
  grid-row: 1;
  text-align: center;
}

.videoContainer {
  grid-column: 2 / 9;
  grid-row: 2;
}

.vjs-subs-caps-button {
  display: none;
}

.sliderContainer {
  grid-column: 2 / 9;
  grid-row: 3;
}

.slider {
  position: relative;
  margin: 0 auto;
  width: 17rem;
}

.frame {
  width: 16.4rem;
  position: relative;
  margin: 0 auto;
  font-size: 0;
  line-height: 0;
  overflow: hidden;
  white-space: nowrap;
}

.slides {
  display: inline-block;
}

.frame li {
  position: relative;
  display: inline-block;
  font-family: 'Source Sans Pro', sans-serif;
  height: 3.2rem;
  text-align: center;
  font-size: 1.6rem;
  line-height: 3.2rem;
  background: #2E435A;
  color: #fff;
  margin-left: 0;
  margin-right: .8rem;
  padding: 0 .8rem;
  cursor: pointer;
}

.prev, .next {
  position: absolute;
  top: 50%;
  margin-top: -25px;
  display: block;
  cursor: pointer;
}

.next {
  right: 0;
}

.prev {
  left: 2.4rem;
}

.next.disabled, .prev.disabled {
  opacity: .3;
  pointer-events: none;
}

.next svg, .prev svg {
  width: 2.5rem;
}

aside {
  grid-column: 1 / 2;
  grid-row: 2 / 4;
  padding-right: 2rem;
  text-align: right;
  border-right: .1rem solid #999;
}

fieldset {
  min-width: 0;
  padding: 0;
  margin: 0;
  border: 0;
}

.categories {
  grid-column: 1 / 9;
  grid-row: 6;
  text-align: center;
}

section {
  grid-column: 1 / 9;
  grid-row: 7;
  text-align: center;
}

.linkInput {
  display: block;
  width: 50%;
  max-width: 50%;
  margin: 0 auto 8rem;
}

.sources {
  display: inline-block;
  margin-top: 0;
  padding: 0;
}

.sources li {
  display: block;
  text-decoration: none;
  letter-spacing: .1rem;
  border: .1rem solid rgba(0,0,200,0.6);
  background: rgba(112,183,253,0.3);
  color: rgba(0,0,200,0.6);
  box-shadow: .1rem .1rem .2rem rgba(0,0,200,0.4);
  border-radius: 1rem;
  padding: .3rem 1rem;
  margin-bottom: 1rem;
  cursor: pointer;
}

.regImg {
  display: inline-block;
}

.categories li, .channels li, .formToggle, button {
  display: inline-block;
  text-decoration: none;
  letter-spacing: .1rem;
  text-transform: uppercase;
  border: .1rem solid rgba(0,0,200,0.6);
  background: rgba(112,183,253,0.3);
  color: rgba(0,0,200,0.6);
  box-shadow: .1rem .1rem .2rem rgba(0,0,200,0.4);
  border-radius: 1rem;
  padding: .3rem 1rem;
  margin-bottom: 1rem;
  cursor: pointer;
}

aside h3 {
  margin-top: 0;
}

form div + div {
  margin-top: 1.6rem;
}

footer {
  grid-column: 1 / 9;
  grid-row: 8;
  text-align: left;
  padding: .8rem;
  letter-spacing: .1rem;
}

footer span {
  margin-left: .8rem;
  margin-right: .8rem;
}

.video-js .vjs-overlay {
  color: #fff;
  position: absolute;
  text-align: center;
}

.video-js .vjs-overlay-background {
  background-color: #aba2a2;
  border-radius: 3px;
}

.video-js .vjs-overlay-center {
  left: 50%;
  top: 50%;
}

.working {
  border: .1rem solid rgba(0, 200, 0, 0.6) !important;
  background:rgba(47, 201, 96, 0.5) !important;
}

.sources .sourceReg, .categories .selected, .channels .selected {
  color: white;
  background: red !important;
}

.hidden {
  display: none !important;
}

.white {
  color: white !important;
}

.bgBlack {
  background-color: black !important;
}

.borderRed {
  border-color: red !important;
}

.alert {
  grid-column: 1 / 9;
  grid-row: 4;
  text-align: center;
  color: red !important;
}

.upComing {
  grid-column: 1 / 9;
  grid-row: 5;
  text-align: center;
  color: rgba(0, 200, 0);
}

.upComing li {
  color: rgba(0, 200, 0) !important;
}

@media (max-width: 468px ) {

  .slider {
    width: 180px;
  }

  .frame {
    width: 110px;
  }
}

@media (min-width: 469px ) {

  .slider {
    width: 230px;
  }

  .frame {
    width: 164px;
  }
}

@media (min-width: 640px ) {

  .slider {
    width: 400px;
  }

  .frame {
    width: 325px;
  }
}

@media (min-width: 1176px ) {

  .slider {
    width: 615px;
  }

  .frame {
    width: 536px;
  }
}

@media (min-width: 1440px ) {

  .slider {
    width: 730px;
  }

  .frame {
    width: 658px;
  }
}

@media (max-width: 991.98px) {
  header {
    text-align: left;
    padding-left: 1.6rem;
  }
  .categories .hbohd {
    display: none;
  }
  footer span {
    display: none;
  }
}

svg {
  fill:#70B7FD; 
  color:#fff; 
  position: absolute; 
  top: 0; 
  border: 0; 
  right: 0;
}

.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>
    <title>HBO直播 - 高清电视直播</title>
  </head>
  <body>
    <header>
      <h1>
        <a href="/">HBO中文直播</a>
      </h1>
      <a href="https://github.com/woniuzfb/iptv" target="_blank" class="github-corner">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
    </header>
    <div class="videoContainer"></div>
    <div class="sliderContainer">
      <div class="slider js_slider">
        <div class="frame js_frame">
            <ul class="slides js_slides">
            </ul>
        </div>
        <span class="js_prev prev">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 501.5 501.5"><g><path fill="#2E435A" d="M302.67 90.877l55.77 55.508L254.575 250.75 358.44 355.116l-55.77 55.506L143.56 250.75z"/></g></svg>
        </span>
        <span class="js_next next">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 501.5 501.5"><g><path fill="#2E435A" d="M199.33 410.622l-55.77-55.508L247.425 250.75 143.56 146.384l55.77-55.507L358.44 250.75z"/></g></svg>
        </span>
      </div>
    </div>
    <div class="alert"></div>
    <div class="upComing"></div>
    <div class="categories">
      <ul>
        <li data-value="hbo" data-source="a8">HBO</li>
        <li data-value="hbohd" data-source="hbo">HBO高清</li>
        <li data-value="myList1" class="dianxin">高清&bull;电信</li>
        <li data-value="myList1a" class="liantong">高清&bull;联通</li>
        <li data-value="myList2">标清</li>
        <li data-value="myList3">央视</li>
        <li data-value="myList4">卫视</li>
        <li data-value="myList5">地方</li>
        <li data-value="myList8">专业</li>
        <li data-value="myList9">自定义</li>
        <li data-value="myList10">港澳台</li>
        <li data-value="0" class="switch">关灯</li>
      </ul>
    </div>
    <section>
      <div class="channels">
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul>
          <input type="text" class="linkInput" placeholder="支持flv、hls">
        </ul>
        <ul></ul>
      </div>
    </section>
    <aside>
      <ul class="sources"></ul>
      <form class="loginForm">
        <fieldset>
          <h3>登录账号</h3>
          <div><input class="loginAcc" type="text" placeholder="用户名"></div>
          <div><input class="loginPwd" type="password" placeholder="密码"></div>
          <div><button class="loginBtn" type="button">登录</button></div>
        </fieldset>
      </form>
      <form class="regForm hidden">
        <fieldset>
          <h3>注册账号</h3>
          <div><input class="regAcc" type="text" placeholder="用户名"></div>
          <div><input class="regPwd" type="password" placeholder="密码"></div>
          <div class="regImg"></div><input type="hidden" class="regImgId">
          <div><input class="regImgInput hidden" type="text" placeholder="图片验证码"></div>
          <div><input class="regSms hidden" type="text" placeholder="短信验证码"></div>
          <div><button class="regBtn" type="button">注册</button></div>
        </fieldset>
      </form>
      <button class="formToggle" type="button">注册</button>
    </aside>
    <footer>
      <a href="mailto:jaykayplay19@gmail.com?subject=%E8%B5%9E%E5%8A%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%20-%20%E5%A2%9E%E5%8A%A0%E9%A2%91%E9%81%93%E8%AF%B7%E6%B1%82%20-%20%E8%B4%A1%E7%8C%AE%E7%9B%B4%E6%92%AD%E6%BA%90&body=---%E8%B5%9E%E5%8A%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%94%A8%E4%BA%8E%E6%96%B0%E5%A2%9E%E9%A2%91%E9%81%93%EF%BC%8C%E5%8F%AA%E6%94%B6%E7%BA%BF%E8%B7%AF%E6%AF%94%E8%BE%83%E5%A5%BD%E5%89%A9%E4%BD%99%E6%97%B6%E9%95%BF1%E4%B8%AA%E6%9C%88%E4%BB%A5%E4%B8%8A%E7%9A%84%E7%A9%BA%E9%97%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88Ubuntu%2FDebian%EF%BC%89%E8%AF%B7%E7%9B%B4%E6%8E%A5%E9%99%84%E4%B8%8Assh%E7%99%BB%E5%BD%95%E6%96%B9%E5%BC%8F---%20%E8%B0%A2%E8%B0%A2%20%3A)">贡献</a>
    </footer>
    <script src="https://cdn.bootcss.com/video.js/7.6.6/video.min.js"></script>
    <script src="https://cdn.bootcss.com/flv.js/1.5.0/flv.min.js"></script>
    <script>
/*videojs-overlay*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/window"],e):t.videojsOverlay=e(t.videojs,t.window)}(this,function(t,e){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var r={align:"top-left",class:"",content:"This overlay will show up while the video is playing",debug:!1,showBackground:!0,attachToControlBar:!1,overlays:[{start:"playing",end:"paused"}]},i=t.getComponent("Component"),o=t.dom||t,s=t.registerPlugin||t.plugin,a=function(t){return"number"==typeof t&&t==t},h=function(t){return"string"==typeof t&&/^\S+$/.test(t)},d=function(r){var i,s;function d(t,e){var i;return i=r.call(this,t,e)||this,["start","end"].forEach(function(t){var e=i.options_[t];if(a(e))i[t+"Event_"]="timeupdate";else if(h(e))i[t+"Event_"]=e;else if("start"===t)throw new Error('invalid "start" option; expected number or string')}),["endListener_","rewindListener_","startListener_"].forEach(function(t){i[t]=function(e){return d.prototype[t].call(n(n(i)),e)}}),"timeupdate"===i.startEvent_&&i.on(t,"timeupdate",i.rewindListener_),i.debug('created, listening to "'+i.startEvent_+'" for "start" and "'+(i.endEvent_||"nothing")+'" for "end"'),i.hide(),i}s=r,(i=d).prototype=Object.create(s.prototype),i.prototype.constructor=i,i.__proto__=s;var l=d.prototype;return l.createEl=function(){var t=this.options_,n=t.content,r=t.showBackground?"vjs-overlay-background":"vjs-overlay-no-background",i=o.createEl("div",{className:"\n        vjs-overlay\n        vjs-overlay-"+t.align+"\n        "+t.class+"\n        "+r+"\n        vjs-hidden\n      "});return"string"==typeof n?i.innerHTML=n:n instanceof e.DocumentFragment?i.appendChild(n):o.appendContent(i,n),i},l.debug=function(){if(this.options_.debug){for(var e=t.log,n=e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];e.hasOwnProperty(i[0])&&"function"==typeof e[i[0]]&&(n=e[i.shift()]),n.apply(void 0,["overlay#"+this.id()+": "].concat(i))}},l.hide=function(){return r.prototype.hide.call(this),this.debug("hidden"),this.debug('bound `startListener_` to "'+this.startEvent_+'"'),this.endEvent_&&(this.debug('unbound `endListener_` from "'+this.endEvent_+'"'),this.off(this.player(),this.endEvent_,this.endListener_)),this.on(this.player(),this.startEvent_,this.startListener_),this},l.shouldHide_=function(t,e){var n=this.options_.end;return a(n)?t>=n:n===e},l.show=function(){return r.prototype.show.call(this),this.off(this.player(),this.startEvent_,this.startListener_),this.debug("shown"),this.debug('unbound `startListener_` from "'+this.startEvent_+'"'),this.endEvent_&&(this.debug('bound `endListener_` to "'+this.endEvent_+'"'),this.on(this.player(),this.endEvent_,this.endListener_)),this},l.shouldShow_=function(t,e){var n=this.options_.start,r=this.options_.end;return a(n)?a(r)?t>=n&&t<r:this.hasShownSinceSeek_?Math.floor(t)===n:(this.hasShownSinceSeek_=!0,t>=n):n===e},l.startListener_=function(t){var e=this.player().currentTime();this.shouldShow_(e,t.type)&&this.show()},l.endListener_=function(t){var e=this.player().currentTime();this.shouldHide_(e,t.type)&&this.hide()},l.rewindListener_=function(t){var e=this.player().currentTime(),n=this.previousTime_,r=this.options_.start,i=this.options_.end;e<n&&(this.debug("rewind detected"),a(i)&&!this.shouldShow_(e)?(this.debug("hiding; "+i+" is an integer and overlay should not show at this time"),this.hasShownSinceSeek_=!1,this.hide()):h(i)&&e<r&&(this.debug("hiding; show point ("+r+") is before now ("+e+") and end point ("+i+") is an event"),this.hasShownSinceSeek_=!1,this.hide())),this.previousTime_=e},d}(i);t.registerComponent("Overlay",d);var l=function(e){var n=this,i=t.mergeOptions(r,e);Array.isArray(this.overlays_)&&this.overlays_.forEach(function(t){n.removeChild(t),n.controlBar&&n.controlBar.removeChild(t),t.dispose()});var o=i.overlays;delete i.overlays,this.overlays_=o.map(function(e){var r=t.mergeOptions(i,e),o="string"==typeof r.attachToControlBar||!0===r.attachToControlBar;if(!n.controls()||!n.controlBar)return n.addChild("overlay",r);if(o&&-1!==r.align.indexOf("bottom")){var s=n.controlBar.children()[0];if(void 0!==n.controlBar.getChild(r.attachToControlBar)&&(s=n.controlBar.getChild(r.attachToControlBar)),s){var a=n.controlBar.addChild("overlay",r);return n.controlBar.el().insertBefore(a.el(),s.el()),a}}var h=n.addChild("overlay",r);return n.el().insertBefore(h.el(),n.controlBar.el()),h})};return l.VERSION="2.1.4",s("overlay",l),l});
/*videojs-flvjs*/
!function e(t,r,o){function n(l,f){if(!r[l]){if(!t[l]){var u="function"==typeof require&&require;if(!f&&u)return u(l,!0);if(i)return i(l,!0);var a=new Error("Cannot find module '"+l+"'");throw a.code="MODULE_NOT_FOUND",a}var c=r[l]={exports:{}};t[l][0].call(c.exports,function(e){var r=t[l][1][e];return n(r||e)},c,c.exports,e,t,r,o)}return r[l].exports}for(var i="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,r){(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),l=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,o)}if("value"in n)return n.value;var l=n.get;if(void 0!==l)return l.call(o)},f="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,u=function(e){return e&&e.__esModule?e:{default:e}}(f),a=u.default.getTech("Html5"),c=u.default.mergeOptions||u.default.util.mergeOptions,s={mediaDataSource:{},config:{}},p=function(e){function r(e,n){return t(this,r),e=c(s,e),o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,n))}return n(r,e),i(r,[{key:"setSrc",value:function(e){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy());var t=this.options_.mediaDataSource,r=this.options_.config;t.type=void 0===t.type?"flv":t.type,t.url=e,this.flvPlayer=window.flvjs.createPlayer(t,r),this.flvPlayer.attachMediaElement(this.el_),this.flvPlayer.load()}},{key:"dispose",value:function(){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy()),l(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"dispose",this).call(this)}}]),r}(a);p.isSupported=function(){return window.flvjs&&window.flvjs.isSupported()},p.formats={"video/flv":"FLV","video/x-flv":"FLV"},p.canPlayType=function(e){return p.isSupported()&&e in p.formats?"maybe":""},p.canPlaySource=function(e,t){return p.canPlayType(e.type)},p.VERSION="0.2.0",u.default.registerTech("Flvjs",p),r.default=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);
/*md5*/
!function(n){"use strict";function t(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]}function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function d(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function h(n){return a(i(d(n),8*n.length))}function l(n,t){var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),e+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return e}function v(n){return unescape(encodeURIComponent(n))}function m(n){return h(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define(function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);
/*promise*/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],u(e,this)}function o(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(f){return void i(n.promise,f)}r(n.promise,o)}else(1===e._state?r:i)(n.promise,e._value)})):e._deferreds.push(n)}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if(n instanceof t)return e._state=3,e._value=n,void f(e);if("function"==typeof o)return void u(function(e,n){return function(){e.apply(n,arguments)}}(o,n),e)}e._state=1,e._value=n,f(e)}catch(r){i(e,r)}}function i(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,r=e._deferreds.length;r>n;n++)o(e,e._deferreds[n]);e._deferreds=null}function u(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,i(n,e))})}catch(o){if(t)return;t=!0,i(n,o)}}var c=setTimeout;t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,t,r)),r},t.prototype["finally"]=e,t.all=function(e){return new t(function(n,t){function o(e,f){try{if(f&&("object"==typeof f||"function"==typeof f)){var u=f.then;if("function"==typeof u)return void u.call(f,function(n){o(e,n)},t)}r[e]=f,0==--i&&n(r)}catch(c){t(c)}}if(!e||"undefined"==typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);for(var i=r.length,f=0;r.length>f;f++)o(f,r[f])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var o=0,r=e.length;r>o;o++)e[o].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},t._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=t});
/*fetch*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.WHATWGFetch={})}(this,function(a){"use strict";var e="URLSearchParams"in self,r="Symbol"in self&&"iterator"in Symbol,h="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in self,n="ArrayBuffer"in self;if(n)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(t){return t&&-1<i.indexOf(Object.prototype.toString.call(t))};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function t(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function c(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function p(r){return new Promise(function(t,e){r.onload=function(){t(r.result)},r.onerror=function(){e(r.error)}})}function y(t){var e=new FileReader,r=p(e);return e.readAsArrayBuffer(t),r}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){(this._bodyInit=t)?"string"==typeof t?this._bodyText=t:h&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:e&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():n&&h&&function(t){return t&&DataView.prototype.isPrototypeOf(t)}(t)?(this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n&&(ArrayBuffer.prototype.isPrototypeOf(t)||s(t))?this._bodyArrayBuffer=l(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h&&(this.blob=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,r=p(e);return e.readAsText(t),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),o=0;o<e.length;o++)r[o]=String.fromCharCode(e[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(t,e){t=u(t),e=f(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},d.prototype.delete=function(t){delete this.map[u(t)]},d.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},d.prototype.set=function(t,e){this.map[u(t)]=f(e)},d.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},d.prototype.keys=function(){var r=[];return this.forEach(function(t,e){r.push(e)}),t(r)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),t(e)},d.prototype.entries=function(){var r=[];return this.forEach(function(t,e){r.push([e,t])}),t(r)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(t,e){var r=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<m.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function v(t){var n=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),r=e.shift().replace(/\+/g," "),o=e.join("=").replace(/\+/g," ");n.append(decodeURIComponent(r),decodeURIComponent(o))}}),n}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var A=[301,302,303,307,308];E.redirect=function(t,e){if(-1===A.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},a.DOMException=self.DOMException;try{new a.DOMException}catch(t){a.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function _(i,s){return new Promise(function(r,t){var e=new w(i,s);if(e.signal&&e.signal.aborted)return t(new a.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function n(){o.abort()}o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:function(t){var n=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),r=e.shift().trim();if(r){var o=e.join(":").trim();n.append(r,o)}}),n}(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;r(new E(e,t))},o.onerror=function(){t(new TypeError("Network request failed"))},o.ontimeout=function(){t(new TypeError("Network request failed"))},o.onabort=function(){t(new a.DOMException("Aborted","AbortError"))},o.open(e.method,e.url,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&h&&(o.responseType="blob"),e.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),e.signal&&(e.signal.addEventListener("abort",n),o.onreadystatechange=function(){4===o.readyState&&e.signal.removeEventListener("abort",n)}),o.send(void 0===e._bodyInit?null:e._bodyInit)})}_.polyfill=!0,self.fetch||(self.fetch=_,self.Headers=d,self.Request=w,self.Response=E),a.Headers=d,a.Request=w,a.Response=E,a.fetch=_,Object.defineProperty(a,"__esModule",{value:!0})});
/*lory*/
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){function n(e,t){var n=W,i=n.classNameActiveSlide;e.forEach(function(e,t){e.classList.contains(i)&&e.classList.remove(i)}),e[t].classList.add(i)}function i(e){var t=W,n=t.infinite,i=e.slice(0,n),o=e.slice(e.length-n,e.length);return i.forEach(function(e){var t=e.cloneNode(!0);k.appendChild(t)}),o.reverse().forEach(function(e){var t=e.cloneNode(!0);k.insertBefore(t,k.firstChild)}),k.addEventListener(T.transitionEnd,x),m.call(k.children)}function o(t,n,i){(0,u.default)(e,t+".lory."+n,i)}function s(e,t,n){var i=k&&k.style;i&&(i[T.transition+"TimingFunction"]=n,i[T.transition+"Duration"]=t+"ms",i[T.transform]="translateX("+e+"px)")}function d(e){return e.getBoundingClientRect().width||e.offsetWidth}function c(e,t){var i=W,r=i.slideSpeed,a=i.slidesToScroll,d=i.infinite,l=i.rewind,c=i.rewindPrev,u=i.rewindSpeed,f=i.ease,v=i.classNameActiveSlide,b=i.classNameDisabledNextCtrl,h=void 0===b?"disabled":b,p=i.classNameDisabledPrevCtrl,L=void 0===p?"disabled":p,E=r,y=void 0,x=t?z+1:z-1,w=Math.round(S-(W.centerMode.enableCenterMode?P[0].clientWidth/2:_));o("before","slide",{index:z,nextSlide:x}),A&&A.classList.remove(L),B&&B.classList.remove(h),"number"!=typeof e&&(e=t?d&&z+2*d!==P.length?z+(d-z%d):z+a:d&&z%d!=0?z-z%d:z-a),e=Math.min(Math.max(e,0),P.length-1),d&&void 0===t&&(e+=d),c&&0===Math.abs(j.x)&&!1===t&&(e=P.length-1,E=u),W.centerMode.enableCenterMode?(y=Math.max(-1*P[e].offsetLeft+_/2-P[e].clientWidth/2,-1*w),y=y>=0&&W.centerMode.firstSlideLeftAlign?0:y):y=Math.min(Math.max(-1*P[e].offsetLeft,-1*w),0),l&&Math.abs(j.x)===w&&t&&(y=0,e=0,E=u),s(y,E,f),j.x=y,P[e].offsetLeft<=w&&(z=e),!d||e!==P.length-d&&e!==P.length-P.length%d&&0!==e||(t&&(z=d),t||(z=P.length-2*d),j.x=-1*P[z].offsetLeft,D=function(){s(-1*P[z].offsetLeft,0,void 0)}),v&&n(m.call(P),z),!A||d||c||0!==e||A.classList.add(L),!B||d||l||e+1!==P.length||B.classList.add(h),o("after","slide",{currentSlide:z})}function f(){o("before","init"),T=(0,a.default)(),W=r({},v.default,t);var s=W,d=s.classNameFrame,l=s.classNameSlideContainer,c=s.classNamePrevCtrl,u=s.classNameNextCtrl,f=s.classNameDisabledNextCtrl,h=void 0===f?"disabled":f,p=s.classNameDisabledPrevCtrl,y=void 0===p?"disabled":p,x=s.enableMouseEvents,M=s.classNameActiveSlide,g=s.initialIndex;z=g,O=e.getElementsByClassName(d)[0],k=O.getElementsByClassName(l)[0],A=e.getElementsByClassName(c)[0],B=e.getElementsByClassName(u)[0],j={x:k.offsetLeft,y:k.offsetTop},A.classList.remove(y),B.classList.remove(h),W.infinite?P=i(m.call(k.children)):(P=m.call(k.children),A&&!W.rewindPrev&&0===z&&A.classList.add(y),B&&1===P.length&&!W.rewind&&B.classList.add(h)),b(),M&&n(P,z),A&&B&&(A.addEventListener("click",L),B.addEventListener("click",E)),O.addEventListener("touchstart",w,F),x&&(O.addEventListener("mousedown",w),O.addEventListener("click",C)),W.window.addEventListener("resize",N),o("after","init")}function b(){var e=W,t=e.infinite,i=e.ease,o=e.rewindSpeed,r=e.rewindOnResize,a=e.classNameActiveSlide,l=e.initialIndex;S=d(k),_=d(O),_===S&&(S=P.reduce(function(e,t){return e+d(t)},0)),r?z=l:(i=null,o=0),t?(s(-1*P[z+t].offsetLeft,0,null),z+=t,j.x=-1*P[z].offsetLeft):W.centerMode.enableCenterMode&&!W.centerMode.firstSlideLeftAlign?(s(-1*P[z].offsetLeft+_/2-P[z].clientWidth/2,o,i),j.x=-1*P[z].offsetLeft+_/2-P[z].clientWidth/2):(s(-1*P[z].offsetLeft,o,i),j.x=-1*P[z].offsetLeft),a&&n(m.call(P),z)}function h(e){c(e)}function p(){return z-W.infinite||0}function L(){c(!1,!1)}function E(){c(!1,!0)}function y(){o("before","destroy"),O.removeEventListener(T.transitionEnd,x),O.removeEventListener("touchstart",w,F),O.removeEventListener("touchmove",M,F),O.removeEventListener("touchend",g),O.removeEventListener("mousemove",M),O.removeEventListener("mousedown",w),O.removeEventListener("mouseup",g),O.removeEventListener("mouseleave",g),O.removeEventListener("click",C),W.window.removeEventListener("resize",N),A&&A.removeEventListener("click",L),B&&B.removeEventListener("click",E),W.infinite&&Array.apply(null,Array(W.infinite)).forEach(function(){k.removeChild(k.firstChild),k.removeChild(k.lastChild)}),o("after","destroy")}function x(){D&&(D(),D=void 0)}function w(e){var t=W,n=t.enableMouseEvents,i=e.touches?e.touches[0]:e;n&&(O.addEventListener("mousemove",M),O.addEventListener("mouseup",g),O.addEventListener("mouseleave",g)),O.addEventListener("touchmove",M,F),O.addEventListener("touchend",g);var r=i.pageX,s=i.pageY;I={x:r,y:s,time:Date.now()},R=void 0,X={},o("on","touchstart",{event:e})}function M(e){var t=e.touches?e.touches[0]:e,n=t.pageX,i=t.pageY;X={x:n-I.x,y:i-I.y},void 0===R&&(R=!!(R||Math.abs(X.x)<Math.abs(X.y))),!R&&I&&s(j.x+X.x,0,null),o("on","touchmove",{event:e})}function g(e){var t=I?Date.now()-I.time:void 0,n=Number(t)<300&&Math.abs(X.x)>25||Math.abs(X.x)>_/3,i=!z&&X.x>0||z===P.length-1&&X.x<0,r=X.x<0;R||(n&&!i?c(!1,r):s(j.x,W.snapBackSpeed)),I=void 0,O.removeEventListener("touchmove",M),O.removeEventListener("touchend",g),O.removeEventListener("mousemove",M),O.removeEventListener("mouseup",g),O.removeEventListener("mouseleave",g),o("on","touchend",{event:e})}function C(e){X.x&&e.preventDefault()}function N(e){_!==d(O)&&(b(),o("on","resize",{event:e}))}var j=void 0,S=void 0,_=void 0,P=void 0,O=void 0,k=void 0,A=void 0,B=void 0,T=void 0,D=void 0,z=0,W={},F=!!(0,l.default)()&&{passive:!0};"undefined"!=typeof jQuery&&e instanceof jQuery&&(e=e[0]);var I=void 0,X=void 0,R=void 0;return f(),{setup:f,reset:b,slideTo:h,returnIndex:p,prev:L,next:E,destroy:y}}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.lory=o;var s=n(1),a=i(s),d=n(2),l=i(d),c=n(3),u=i(c),f=n(6),v=i(f),m=Array.prototype.slice},function(e,t,n){"use strict";function i(){var e=void 0,t=void 0,n=void 0;return function(){var i=document.createElement("_"),o=i.style,r=void 0;""===o[r="webkitTransition"]&&(n="webkitTransitionEnd",t=r),""===o[r="transition"]&&(n="transitionend",t=r),""===o[r="webkitTransform"]&&(e=r),""===o[r="msTransform"]&&(e=r),""===o[r="transform"]&&(e=r),document.body.insertBefore(i,null),o[e]="translateX(0)",document.body.removeChild(i)}(),{transform:e,transition:t,transitionEnd:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";function i(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";function i(e,t,n){var i=new r.default(t,{bubbles:!0,cancelable:!0,detail:n});e.dispatchEvent(i)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var o=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){(function(t){var n=t.CustomEvent;e.exports=function(){try{var e=new n("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?n:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}).call(t,n(5))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={slidesToScroll:1,slideSpeed:300,rewindSpeed:600,snapBackSpeed:200,ease:"ease",rewind:!1,infinite:!1,initialIndex:0,classNameFrame:"js_frame",classNameSlideContainer:"js_slides",classNamePrevCtrl:"js_prev",classNameNextCtrl:"js_next",classNameActiveSlide:"active",enableMouseEvents:!1,window:"undefined"!=typeof window?window:null,rewindOnResize:!0,centerMode:{enableCenterMode:!1,firstSlideLeftAlign:!1}}},function(e,t,n){e.exports=n(0)}])});
/*muxjs*/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.muxjs=t()}}(function(){return function(){function t(e,i,n){function a(s,o){if(!i[s]){if(!e[s]){var d="function"==typeof require&&require;if(!o&&d)return d(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){return a(e[s][1][t]||t)},h,h.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}return t}()({1:[function(t,e,i){"use strict";var n,a=t(42),r=t(2);n=function(){var t=new Uint8Array,e=0;n.prototype.init.call(this),this.setTimestamp=function(t){e=t},this.push=function(i){var n,a,s,o,d=0,p=0;for(t.length?(o=t.length,t=new Uint8Array(i.byteLength+o),t.set(t.subarray(0,o)),t.set(i,o)):t=i;t.length-p>=3;)if(t[p]!=="I".charCodeAt(0)||t[p+1]!=="D".charCodeAt(0)||t[p+2]!=="3".charCodeAt(0))if(255!=(255&t[p])||240!=(240&t[p+1]))p++;else{if(t.length-p<7)break;if(d=r.parseAdtsSize(t,p),p+d>t.length)break;s={type:"audio",data:t.subarray(p,p+d),pts:e,dts:e},this.trigger("data",s),p+=d}else{if(t.length-p<10)break;if(d=r.parseId3TagSize(t,p),p+d>t.length)break;a={type:"timed-metadata",data:t.subarray(p,p+d)},this.trigger("data",a),p+=d}n=t.length-p,t=n>0?t.subarray(p):new Uint8Array},this.reset=function(){t=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){t=new Uint8Array,this.trigger("endedtimeline")}},n.prototype=new a,e.exports=n},{2:2,42:42}],2:[function(t,e,i){"use strict";var n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},r=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},s=function(t,e,i){var n,a="";for(n=e;n<i;n++)a+="%"+("00"+t[n].toString(16)).slice(-2);return a},o=function(t,e,i){return unescape(s(t,e,i))},d=function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return(16&t[e+5])>>4?i+20:i+10},p=function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},h=function(t,e){return t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&t[e]&&240==(240&t[e+1])?"audio":null},u=function(t){for(var e=0;e+5<t.length;){if(255===t[e]&&240==(246&t[e+1]))return n[(60&t[e+2])>>>2];e++}return null},l=function(t){var e,i,n;e=10,64&t[5]&&(e+=4,e+=r(t.subarray(10,14)));do{if((i=r(t.subarray(e+4,e+8)))<1)return null;if("PRIV"===String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3])){n=t.subarray(e+10,e+i+10);for(var a=0;a<n.byteLength;a++)if(0===n[a]){var s=o(n,0,a);if("com.apple.streaming.transportStreamTimestamp"===s){var d=n.subarray(a+1),p=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;return p*=4,p+=3&d[7]}break}}e+=10,e+=i}while(e<t.byteLength);return null};e.exports={isLikelyAacData:a,parseId3TagSize:d,parseAdtsSize:p,parseType:h,parseSampleRate:u,parseAacTimestamp:l}},{}],3:[function(t,e,i){"use strict";var n,a=t(42),r=t(40).ONE_SECOND_IN_TS,s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=function(t){var e,i=0;n.prototype.init.call(this),this.push=function(n){var a,o,d,p,h,u,l=0;if(t||(i=0),"audio"===n.type)for(e?(p=e,e=new Uint8Array(p.byteLength+n.data.byteLength),e.set(p),e.set(n.data,p.byteLength)):e=n.data;l+5<e.length;)if(255===e[l]&&240==(246&e[l+1])){if(o=2*(1&~e[l+1]),a=(3&e[l+3])<<11|e[l+4]<<3|(224&e[l+5])>>5,h=1024*(1+(3&e[l+6])),u=h*r/s[(60&e[l+2])>>>2],d=l+a,e.byteLength<d)return;if(this.trigger("data",{pts:n.pts+i*u,dts:n.dts+i*u,sampleCount:h,audioobjecttype:1+(e[l+2]>>>6&3),channelcount:(1&e[l+2])<<2|(192&e[l+3])>>>6,samplerate:s[(60&e[l+2])>>>2],samplingfrequencyindex:(60&e[l+2])>>>2,samplesize:16,data:e.subarray(l+7+o,d)}),i++,e.byteLength===d)return void(e=void 0);e=e.subarray(d)}else l++},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){e=void 0,this.trigger("reset")},this.endTimeline=function(){e=void 0,this.trigger("endedtimeline")}},n.prototype=new a,e.exports=n},{40:40,42:42}],4:[function(t,e,i){"use strict";var n,a,r,s=t(42),o=t(41);a=function(){var t,e,i=0;a.prototype.init.call(this),this.push=function(n){var a;e?(a=new Uint8Array(e.byteLength+n.data.byteLength),a.set(e),a.set(n.data,e.byteLength),e=a):e=n.data;for(var r=e.byteLength;i<r-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<r;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}i+3!==t-2&&this.trigger("data",e.subarray(i+3,t-2));do{t++}while(1!==e[t]&&t<r);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.reset=function(){e=null,i=0,this.trigger("reset")},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},a.prototype=new s,r={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},n=function(){var t,e,i,s,d,p,h,u=new a;n.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(e=t.trackId,i=t.pts,s=t.dts,u.push(t))},u.on("data",function(n){var a={trackId:e,pts:i,dts:s,data:n};switch(31&n[0]){case 5:a.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:a.nalUnitType="sei_rbsp",a.escapedRBSP=d(n.subarray(1));break;case 7:a.nalUnitType="seq_parameter_set_rbsp",a.escapedRBSP=d(n.subarray(1)),a.config=p(a.escapedRBSP);break;case 8:a.nalUnitType="pic_parameter_set_rbsp";break;case 9:a.nalUnitType="access_unit_delimiter_rbsp";break;case 10:a.nalUnitType="end_of_seq_rbsp"}t.trigger("data",a)}),u.on("done",function(){t.trigger("done")}),u.on("partialdone",function(){t.trigger("partialdone")}),u.on("reset",function(){t.trigger("reset")}),u.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){u.flush()},this.partialFlush=function(){u.partialFlush()},this.reset=function(){u.reset()},this.endTimeline=function(){u.endTimeline()},h=function(t,e){var i,n,a=8,r=8;for(i=0;i<t;i++)0!==r&&(n=e.readExpGolomb(),r=(a+n+256)%256),a=0===r?a:r},d=function(t){for(var e,i,n=t.byteLength,a=[],r=1;r<n-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return t;e=n-a.length,i=new Uint8Array(e);var s=0;for(r=0;r<e;s++,r++)s===a[0]&&(s++,a.shift()),i[r]=t[s];return i},p=function(t){var e,i,n,a,s,d,p,u,l,c,f,m,g,y=0,b=0,S=0,v=0,T=1;if(e=new o(t),i=e.readUnsignedByte(),a=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),r[i]&&(s=e.readUnsignedExpGolomb(),3===s&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(f=3!==s?8:12,g=0;g<f;g++)e.readBoolean()&&(g<6?h(16,e):h(64,e));if(e.skipUnsignedExpGolomb(),0===(d=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===d)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),p=e.readUnsignedExpGolomb(),g=0;g<p;g++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),u=e.readUnsignedExpGolomb(),l=e.readUnsignedExpGolomb(),c=e.readBits(1),0===c&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(y=e.readUnsignedExpGolomb(),b=e.readUnsignedExpGolomb(),S=e.readUnsignedExpGolomb(),v=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:m=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}m&&(T=m[0]/m[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:a,width:Math.ceil((16*(u+1)-2*y-2*b)*T),height:(2-c)*(l+1)*16-2*S-2*v,sarRatio:m}}},n.prototype=new s,e.exports={H264Stream:n,NalByteStream:a}},{41:41,42:42}],5:[function(t,e,i){e.exports={Adts:t(3),h264:t(4)}},{3:3,4:4}],6:[function(t,e,i){var n=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"];e.exports=n},{}],7:[function(t,e,i){var n=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"];e.exports=n},{}],8:[function(t,e,i){var n,a=[33,16,5,32,164,27],r=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],s=function(t){for(var e=[];t--;)e.push(0);return e},o=function(t){return Object.keys(t).reduce(function(e,i){return e[i]=new Uint8Array(t[i].reduce(function(t,e){return t.concat(e)},[])),e},{})};e.exports=function(){if(!n){var t={96e3:[a,[227,64],s(154),[56]],88200:[a,[231],s(170),[56]],64e3:[a,[248,192],s(240),[56]],48e3:[a,[255,192],s(268),[55,148,128],s(54),[112]],44100:[a,[255,192],s(268),[55,163,128],s(84),[112]],32e3:[a,[255,192],s(268),[55,234],s(226),[112]],24e3:[a,[255,192],s(268),[55,255,128],s(268),[111,112],s(126),[224]],16e3:[a,[255,192],s(268),[55,255,128],s(268),[111,255],s(269),[223,108],s(195),[1,192]],12e3:[r,s(268),[3,127,248],s(268),[6,255,240],s(268),[13,255,224],s(268),[27,253,128],s(259),[56]],11025:[r,s(268),[3,127,248],s(268),[6,255,240],s(268),[13,255,224],s(268),[27,255,192],s(268),[55,175,128],s(108),[112]],8e3:[r,s(268),[3,121,16],s(47),[7]]};n=o(t)}return n}},{}],9:[function(t,e,i){"use strict";var n=t(42),a=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,a.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}};a.prototype=new n,a.prototype.flush=function(t){var e,i,n,a,r={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(0===this.pendingTracks&&++this.processedTracks<this.numberOfTracks)return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?a=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(a=this.audioTrack.timelineStartInfo.pts),r.tags.videoTags=this.videoTags,r.tags.audioTags=this.audioTags,n=0;n<this.pendingCaptions.length;n++)i=this.pendingCaptions[n],i.startTime=i.startPts-a,i.startTime/=9e4,i.endTime=i.endPts-a,i.endTime/=9e4,r.captionStreams[i.stream]=!0,r.captions.push(i);for(n=0;n<this.pendingMetadata.length;n++)e=this.pendingMetadata[n],e.cueTime=e.pts-a,e.cueTime/=9e4,r.metadata.push(e);r.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",r),this.trigger("done")}},e.exports=a},{42:42}],10:[function(t,e,i){"use strict";var n=t(11),a=function(t,e,i){var a,r,s,o=new Uint8Array(9),d=new DataView(o.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,d.setUint8(0,70),d.setUint8(1,76),d.setUint8(2,86),d.setUint8(3,1),d.setUint8(4,(e?4:0)|(i?1:0)),d.setUint32(5,o.byteLength),t<=0?(r=new Uint8Array(o.byteLength+4),r.set(o),r.set([0,0,0,0],o.byteLength),r):(a=new n(n.METADATA_TAG),a.pts=a.dts=0,a.writeMetaDataDouble("duration",t),s=a.finalize().length,r=new Uint8Array(o.byteLength+s),r.set(o),r.set(d.byteLength,s),r)};e.exports=a},{11:11}],11:[function(t,e,i){"use strict";var n;n=function(t,e){var i,a=0,r=16384,s=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||(i=new Uint8Array(2*n),i.set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},o=n.widthBytes||new Uint8Array("width".length),d=n.heightBytes||new Uint8Array("height".length),p=n.videocodecidBytes||new Uint8Array("videocodecid".length);if(!n.widthBytes){for(i=0;i<"width".length;i++)o[i]="width".charCodeAt(i);for(i=0;i<"height".length;i++)d[i]="height".charCodeAt(i);for(i=0;i<"videocodecid".length;i++)p[i]="videocodecid".charCodeAt(i);n.widthBytes=o,n.heightBytes=d,n.videocodecidBytes=p}switch(this.keyFrame=!1,t){case n.VIDEO_TAG:this.length=16,r*=6;break;case n.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case n.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=e,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,a=e||0;i=i||t.byteLength,n=a+i,s(this,i),this.bytes.set(t.subarray(a,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){s(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){s(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===a?0:this.length-(a+4)},this.startNalUnit=function(){if(a>0)throw new Error("Attempted to create new NAL wihout closing the old one");a=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===a+4?this.length-=4:a>0&&(e=a+4,i=this.length-e,this.position=a,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),a=0},this.writeMetaDataDouble=function(t,e){var i;if(s(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(o,this.position),this.position+=5;else if("height"===t)this.bytes.set(d,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(p,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++a},this.writeMetaDataBoolean=function(t,e){var i;for(s(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)s(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;s(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++a},this.finalize=function(){var t,i;switch(this.bytes[0]){case n.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||e?16:32),this.bytes[12]=e?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case n.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=e?0:1;break;case n.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,a),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return i=this.length-11,this.bytes[1]=(16711680&i)>>>16,this.bytes[2]=(65280&i)>>>8,this.bytes[3]=(255&i)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,s(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=n.frameTime(this.bytes),this}},n.AUDIO_TAG=8,n.VIDEO_TAG=9,n.METADATA_TAG=18,n.isAudioFrame=function(t){return n.AUDIO_TAG===t[0]},n.isVideoFrame=function(t){return n.VIDEO_TAG===t[0]},n.isMetaData=function(t){return n.METADATA_TAG===t[0]},n.isKeyFrame=function(t){return n.isVideoFrame(t)?23===t[11]:!!n.isAudioFrame(t)||!!n.isMetaData(t)},n.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24},e.exports=n},{}],12:[function(t,e,i){e.exports={tag:t(11),Transmuxer:t(14),getFlvHeader:t(10)}},{10:10,11:11,14:14}],13:[function(t,e,i){"use strict";var n=function(){var t=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return t.list.length}})};e.exports=n},{}],14:[function(t,e,i){"use strict";var n,a,r,s,o,d,p=t(42),h=t(11),u=t(18),l=t(3),c=t(4).H264Stream,f=t(9),m=t(13);s=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},o=function(t,e){var i=new h(h.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},d=function(t,e){var i,n=new h(h.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},r=function(t){var e,i=[],n=[];r.prototype.init.call(this),this.push=function(e){s(t,e),t&&(t.audioobjecttype=e.audioobjecttype,t.channelcount=e.channelcount,t.samplerate=e.samplerate,t.samplingfrequencyindex=e.samplingfrequencyindex,t.samplesize=e.samplesize,t.extraData=t.audioobjecttype<<11|t.samplingfrequencyindex<<7|t.channelcount<<3),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),i.push(e)},this.flush=function(){var a,r,s,o=new m;if(0===i.length)return void this.trigger("done","AudioSegmentStream");for(s=-1/0;i.length;)a=i.shift(),n.length&&a.pts>=n[0]&&(s=n.shift(),this.writeMetaDataTags(o,s)),(t.extraData!==e||a.pts-s>=1e3)&&(this.writeMetaDataTags(o,a.pts),e=t.extraData,s=a.pts),r=new h(h.AUDIO_TAG),r.pts=a.pts,r.dts=a.dts,r.writeBytes(a.data),o.push(r.finalize());n.length=0,e=null,this.trigger("data",{track:t,tags:o.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(e,i){var n;n=new h(h.METADATA_TAG),n.pts=i,n.dts=i,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===t.channelcount),n.writeMetaDataDouble("audiosamplerate",t.samplerate),n.writeMetaDataDouble("audiosamplesize",16),e.push(n.finalize()),n=new h(h.AUDIO_TAG,!0),n.pts=i,n.dts=i,n.view.setUint16(n.position,t.extraData),n.position+=2,n.length=Math.max(n.length,n.position),e.push(n.finalize())},this.onVideoKeyFrame=function(t){n.push(t)}},r.prototype=new p,a=function(t){var e,i,n=[];a.prototype.init.call(this),this.finishFrame=function(n,a){if(a){if(e&&t&&t.newMetadata&&(a.keyFrame||0===n.length)){var r=o(e,a.dts).finalize(),s=d(t,a.dts).finalize();r.metaDataTag=s.metaDataTag=!0,n.push(r),n.push(s),t.newMetadata=!1,this.trigger("keyframe",a.dts)}a.endNalUnit(),n.push(a.finalize()),i=null}},this.push=function(e){s(t,e),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),n.push(e)},this.flush=function(){for(var a,r=new m;n.length&&"access_unit_delimiter_rbsp"!==n[0].nalUnitType;)n.shift();if(0===n.length)return void this.trigger("done","VideoSegmentStream");for(;n.length;)a=n.shift(),"seq_parameter_set_rbsp"===a.nalUnitType?(t.newMetadata=!0,e=a.config,t.width=e.width,t.height=e.height,t.sps=[a.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility,i.endNalUnit()):"pic_parameter_set_rbsp"===a.nalUnitType?(t.newMetadata=!0,t.pps=[a.data],i.endNalUnit()):"access_unit_delimiter_rbsp"===a.nalUnitType?(i&&this.finishFrame(r,i),i=new h(h.VIDEO_TAG),i.pts=a.pts,i.dts=a.dts):("slice_layer_without_partitioning_rbsp_idr"===a.nalUnitType&&(i.keyFrame=!0),i.endNalUnit()),i.startNalUnit(),i.writeBytes(a.data);i&&this.finishFrame(r,i),this.trigger("data",{track:t,tags:r.list}),this.trigger("done","VideoSegmentStream")}},a.prototype=new p,n=function(t){var e,i,s,o,d,p,h,m,g,y,b,S,v=this;n.prototype.init.call(this),t=t||{},this.metadataStream=new u.MetadataStream,t.metadataStream=this.metadataStream,e=new u.TransportPacketStream,i=new u.TransportParseStream,s=new u.ElementaryStream,o=new u.TimestampRolloverStream("video"),d=new u.TimestampRolloverStream("audio"),p=new u.TimestampRolloverStream("timed-metadata"),h=new l,m=new c,S=new f(t),e.pipe(i).pipe(s),s.pipe(o).pipe(m),s.pipe(d).pipe(h),s.pipe(p).pipe(this.metadataStream).pipe(S),b=new u.CaptionStream,m.pipe(b).pipe(S),s.on("data",function(t){var e,i,n;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(n=t.tracks[e]);i&&!g&&(S.numberOfTracks++,g=new a(i),m.pipe(g).pipe(S)),n&&!y&&(S.numberOfTracks++,y=new r(n),h.pipe(y).pipe(S),g&&g.on("keyframe",y.onVideoKeyFrame))}}),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},this.resetCaptions=function(){b.reset()},S.on("data",function(t){v.trigger("data",t)}),S.on("done",function(){v.trigger("done")})},n.prototype=new p,e.exports=n},{11:11,13:13,18:18,3:3,4:4,42:42,9:9}],15:[function(t,e,i){"use strict";var n={codecs:t(5),mp4:t(26),flv:t(12),mp2t:t(17),partial:t(32)};n.mp4.tools=t(37),n.flv.tools=t(36),n.mp2t.tools=t(38),e.exports=n},{12:12,17:17,26:26,32:32,36:36,37:37,38:38,5:5}],16:[function(t,e,i){"use strict";var n=t(42),a=t(35),r=function(){r.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new h(0,0),new h(0,1),new h(1,0),new h(1,1)],this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this)};r.prototype=new n,r.prototype.push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&(e=a.parseSei(t.escapedRBSP),e.payloadType===a.USER_DATA_REGISTERED_ITU_T_T35&&(i=a.parseUserData(e)))){if(t.dts<this.latestDts_)return void(this.ignoreNextEqualDts_=!0);if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return void(--this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=a.parseCaptionPackets(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},r.prototype.flushCCStreams=function(t){this.ccStreams_.forEach(function(e){return"flush"===t?e.flush():e.partialFlush()},this)},r.prototype.flushStream=function(t){if(!this.captionPackets_.length)return void this.flushCCStreams(t);this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2&&this.dispatchCea608Packet(t)},this),this.captionPackets_.length=0,this.flushCCStreams(t)},r.prototype.flush=function(){return this.flushStream("flush")},r.prototype.partialFlush=function(){return this.flushStream("partialFlush")},r.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},r.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},r.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},r.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)},r.prototype.setsTextOrXDSActive=function(t){return 256==(28928&t.ccData)||4138==(30974&t.ccData)||6186==(30974&t.ccData)};var s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},o=function(t){return null===t?"":(t=s[t]||t,String.fromCharCode(t))},d=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],p=function(){for(var t=[],e=15;e--;)t.push("");return t},h=function(t,e){h.prototype.init.call(this),this.field_=t||0,this.dataChannel_=e||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,a,r;if((e=32639&t.ccData)===this.lastControlCode_)return void(this.lastControlCode_=null);if(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,a=255&e,e!==this.PADDING_)if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=p();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=p();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=p()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,a))n=(3&n)<<8,r=o(n|a),this[this.mode_](t.pts,r),this.column_++;else if(this.isExtCharacter(n,a))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),n=(3&n)<<8,r=o(n|a),this[this.mode_](t.pts,r),this.column_++;else if(this.isMidRowCode(n,a))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&a)&&this.addFormatting(t.pts,["i"]),1==(1&a)&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,a))this.column_+=3&a;else if(this.isPAC(n,a)){var s=d.indexOf(7968&e);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(t.pts,s)),s!==this.row_&&(this.clearFormatting(t.pts),this.row_=s),1&a&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)&&(this.column_=4*((14&e)>>1)),this.isColorPAC(a)&&14==(14&a)&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===a&&(a=null),r=o(n),r+=o(a),this[this.mode_](t.pts,r),this.column_+=r.length)}};h.prototype=new n,h.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){try{return t.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},h.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=p(),this.nonDisplayed_=p(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},h.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},h.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&e>=48&&e<=63},h.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&e>=32&&e<=63},h.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&e>=32&&e<=47},h.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&e>=33&&e<=35},h.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&e>=64&&e<=127},h.prototype.isColorPAC=function(t){return t>=64&&t<=79||t>=96&&t<=127},h.prototype.isNormalChar=function(t){return t>=32&&t<=127},h.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=p(),this.displayed_=p()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},h.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,i)},h.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},"");this.formatting_=[],this[this.mode_](t,e)}},h.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},h.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},h.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},h.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},e.exports={CaptionStream:r,Cea608Stream:h}},{35:35,42:42}],17:[function(t,e,i){e.exports=t(18)},{18:18}],18:[function(t,e,i){"use strict";var n,a,r,s=t(42),o=t(16),d=t(21),p=t(22).TimestampRolloverStream;n=function(){var t=new Uint8Array(188),e=0;n.prototype.init.call(this),this.push=function(i){var n,a=0,r=188;for(e?(n=new Uint8Array(i.byteLength+e),n.set(t.subarray(0,e)),n.set(i,e),e=0):n=i;r<n.byteLength;)71!==n[a]||71!==n[r]?(a++,r++):(this.trigger("data",n.subarray(a,r)),a+=188,r+=188);a<n.byteLength&&(t.set(n.subarray(a),0),e=n.byteLength-a)},this.flush=function(){188===e&&71===t[0]&&(this.trigger("data",t),e=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){e=0,this.trigger("reset")}},n.prototype=new s,a=function(){var t,e,i,n;a.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,t=function(t,n){var a=0;n.payloadUnitStartIndicator&&(a+=t[a]+1),"pat"===n.type?e(t.subarray(a),n):i(t.subarray(a),n)},e=function(t,e){e.section_number=t[7],
e.last_section_number=t[8],n.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=n.pmtPid},i=function(t,e){var i,a,r,s;if(1&t[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=(15&t[1])<<8|t[2],a=3+i-4,r=(15&t[10])<<8|t[11],s=12+r;s<a;){var o=t[s],p=(31&t[s+1])<<8|t[s+2];o===d.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=p:o===d.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=p:o===d.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][p]=o),s+=5+((15&t[s+3])<<8|t[s+4])}e.programMapTable=n.programMapTable}},this.push=function(e){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&e[1]),i.pid=31&e[1],i.pid<<=8,i.pid|=e[2],(48&e[3])>>>4>1&&(n+=e[n]+1),0===i.pid)i.type="pat",t(e.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",t(e.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,n,i]):this.processPes_(e,n,i)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=d.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=d.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}},a.prototype=new s,a.STREAM_TYPES={h264:27,adts:15},r=function(){var t,e=this,i={data:[],size:0},n={data:[],size:0},a={data:[],size:0},s=function(t,e){var i;e.packetLength=6+(t[4]<<8|t[5]),e.dataAlignmentIndicator=0!=(4&t[6]),i=t[7],192&i&&(e.pts=(14&t[9])<<27|(255&t[10])<<20|(254&t[11])<<12|(255&t[12])<<5|(254&t[13])>>>3,e.pts*=4,e.pts+=(6&t[13])>>>1,e.dts=e.pts,64&i&&(e.dts=(14&t[14])<<27|(255&t[15])<<20|(254&t[16])<<12|(255&t[17])<<5|(254&t[18])>>>3,e.dts*=4,e.dts+=(6&t[18])>>>1)),e.data=t.subarray(9+t[8])},o=function(t,i,n){var a,r=new Uint8Array(t.size),o={type:i},d=0,p=0,h=!1;if(t.data.length&&!(t.size<9)){for(o.trackId=t.data[0].pid,d=0;d<t.data.length;d++)a=t.data[d],r.set(a.data,p),p+=a.data.byteLength;s(r,o),h="video"===i||o.packetLength<=t.size,(n||h)&&(t.size=0,t.data.length=0),h&&e.trigger("data",o)}};r.prototype.init.call(this),this.push=function(r){({pat:function(){},pes:function(){var t,e;switch(r.streamType){case d.H264_STREAM_TYPE:t=i,e="video";break;case d.ADTS_STREAM_TYPE:t=n,e="audio";break;case d.METADATA_STREAM_TYPE:t=a,e="timed-metadata";break;default:return}r.payloadUnitStartIndicator&&o(t,e,!0),t.data.push(r),t.size+=r.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]};t=r.programMapTable,null!==t.video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),e.trigger("data",i)}})[r.type]()},this.reset=function(){i.size=0,i.data.length=0,n.size=0,n.data.length=0,this.trigger("reset")},this.flushStreams_=function(){o(i,"video"),o(n,"audio"),o(a,"timed-metadata")},this.flush=function(){this.flushStreams_(),this.trigger("done")}},r.prototype=new s;var h={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:n,TransportParseStream:a,ElementaryStream:r,TimestampRolloverStream:p,CaptionStream:o.CaptionStream,Cea608Stream:o.Cea608Stream,MetadataStream:t(19)};for(var u in d)d.hasOwnProperty(u)&&(h[u]=d[u]);e.exports=h},{16:16,19:19,21:21,22:22,42:42}],19:[function(t,e,i){"use strict";var n,a=t(42),r=t(21),s=function(t,e,i){var n,a="";for(n=e;n<i;n++)a+="%"+("00"+t[n].toString(16)).slice(-2);return a},o=function(t,e,i){return decodeURIComponent(s(t,e,i))},d=function(t,e,i){return unescape(s(t,e,i))},p=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},h={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.value=o(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=o(t.data,1,e),t.url=o(t.data,e+1,t.data.length);break}},PRIV:function(t){var e;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=d(t.data,0,e);break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};n=function(t){var e,i={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},a=0,s=[],o=0;if(n.prototype.init.call(this),this.dispatchType=r.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(e=0;e<i.descriptor.length;e++)this.dispatchType+=("00"+i.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,n,r,d,u,l;if("timed-metadata"===t.type){if(t.dataAlignmentIndicator&&(o=0,s.length=0),0===s.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))return void(i.debug&&console.log("Skipping unrecognized metadata packet"));if(s.push(t),o+=t.data.byteLength,1===s.length&&(a=p(t.data.subarray(6,10)),a+=10),!(o<a)){for(e={data:new Uint8Array(a),frames:[],pts:s[0].pts,dts:s[0].dts},u=0;u<a;)e.data.set(s[0].data.subarray(0,a-u),u),u+=s[0].data.byteLength,o-=s[0].data.byteLength,s.shift();n=10,64&e.data[5]&&(n+=4,n+=p(e.data.subarray(10,14)),a-=p(e.data.subarray(16,20)));do{if((r=p(e.data.subarray(n+4,n+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if(l=String.fromCharCode(e.data[n],e.data[n+1],e.data[n+2],e.data[n+3]),d={id:l,data:e.data.subarray(n+10,n+r+10)},d.key=d.id,h[d.id]&&(h[d.id](d),"com.apple.streaming.transportStreamTimestamp"===d.owner)){var c=d.data,f=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;f*=4,f+=3&c[7],d.timeStamp=f,void 0===e.pts&&void 0===e.dts&&(e.pts=d.timeStamp,e.dts=d.timeStamp),this.trigger("timestamp",d)}e.frames.push(d),n+=10,n+=r}while(n<a);this.trigger("data",e)}}}},n.prototype=new a,e.exports=n},{21:21,42:42}],20:[function(t,e,i){"use strict";var n=t(21),a=function(t){var e=31&t[1];return e<<=8,e|=t[2]},r=function(t){return!!(64&t[1])},s=function(t){var e=0;return(48&t[3])>>>4>1&&(e+=t[4]+1),e},o=function(t,e){var i=a(t);return 0===i?"pat":i===e?"pmt":e?"pes":null},d=function(t){var e=r(t),i=4+s(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},p=function(t){var e={},i=r(t),n=4+s(t);if(i&&(n+=t[n]+1),1&t[n+5]){var a,o,d;a=(15&t[n+1])<<8|t[n+2],o=3+a-4,d=(15&t[n+10])<<8|t[n+11];for(var p=12+d;p<o;){var h=n+p;e[(31&t[h+1])<<8|t[h+2]]=t[h],p+=5+((15&t[h+3])<<8|t[h+4])}return e}},h=function(t,e){switch(e[a(t)]){case n.H264_STREAM_TYPE:return"video";case n.ADTS_STREAM_TYPE:return"audio";case n.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},u=function(t){if(!r(t))return null;var e=4+s(t);if(e>=t.byteLength)return null;var i,n=null;return i=t[e+7],192&i&&(n={},n.pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},l=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},c=function(t){for(var e,i=4+s(t),n=t.subarray(i),a=0,r=0,o=!1;r<n.byteLength-3;r++)if(1===n[r+2]){a=r+5;break}for(;a<n.byteLength;)switch(n[a]){case 0:if(0!==n[a-1]){a+=2;break}if(0!==n[a-2]){a++;break}r+3!==a-2&&"slice_layer_without_partitioning_rbsp_idr"===(e=l(31&n[r+3]))&&(o=!0);do{a++}while(1!==n[a]&&a<n.length);r=a-2,a+=3;break;case 1:if(0!==n[a-1]||0!==n[a-2]){a+=3;break}e=l(31&n[r+3]),"slice_layer_without_partitioning_rbsp_idr"===e&&(o=!0),r=a-2,a+=3;break;default:a+=3}return n=n.subarray(r),a-=r,r=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===(e=l(31&n[r+3]))&&(o=!0),o};e.exports={parseType:o,parsePat:d,parsePmt:p,parsePayloadUnitStartIndicator:r,parsePesType:h,parsePesTime:u,videoPacketContainsKeyFrame:c}},{21:21}],21:[function(t,e,i){"use strict";e.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],22:[function(t,e,i){"use strict";var n=t(42),a=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},r=function(t){var e,i;r.prototype.init.call(this),this.type_=t||"shared",this.push=function(t){"shared"!==this.type_&&t.type!==this.type_||(void 0===i&&(i=t.dts),t.dts=a(t.dts,i),t.pts=a(t.pts,i),e=t.dts,this.trigger("data",t))},this.flush=function(){i=e,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,e=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};r.prototype=new n,e.exports={TimestampRolloverStream:r,handleRollover:a}},{42:42}],23:[function(t,e,i){var n=t(8),a=t(40),r=function(t){var e,i,n=0;for(e=0;e<t.length;e++)i=t[e],n+=i.data.byteLength;return n},s=function(t,e,i,r){var s,o,d,p,h=0,u=0,l=0,c=0;if(e.length&&(s=a.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),h=Math.ceil(a.ONE_SECOND_IN_TS/(t.samplerate/1024)),i&&r&&(u=s-Math.max(i,r),l=Math.floor(u/h),c=l*h),!(l<1||c>a.ONE_SECOND_IN_TS/2))){for(o=n()[t.samplerate],o||(o=e[0].data),d=0;d<l;d++)p=e[0],e.splice(0,0,{data:o,dts:p.dts-h,pts:p.pts-h});t.baseMediaDecodeTime-=Math.floor(a.videoTsToAudioTs(c,t.samplerate))}},o=function(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},d=function(t){var e,i,n=[];for(e=0;e<t.length;e++)i=t[e],n.push({size:i.data.byteLength,duration:1024});return n},p=function(t){var e,i,n=0,a=new Uint8Array(r(t));for(e=0;e<t.length;e++)i=t[e],a.set(i.data,n),n+=i.data.byteLength;return a};e.exports={prefixWithSilence:s,trimAdtsFramesByEarliestDts:o,generateSampleTable:d,concatenateFrameData:p}},{40:40,8:8}],24:[function(t,e,i){"use strict";var n=t(35).discardEmulationPreventionBytes,a=t(16).CaptionStream,r=t(28),s=t(37),o=function(t,e){for(var i=t,n=0;n<e.length;n++){var a=e[n];if(i<a.size)return a;i-=a.size}return null},d=function(t,e,i){var a,r,s,d,p=new DataView(t.buffer,t.byteOffset,t.byteLength),h=[];for(r=0;r+4<t.length;r+=s)if(s=p.getUint32(r),r+=4,!(s<=0))switch(31&t[r]){case 6:var u=t.subarray(r+1,r+1+s),l=o(r,e);if(a={nalUnitType:"sei_rbsp",size:s,data:u,escapedRBSP:n(u),trackId:i},l)a.pts=l.pts,a.dts=l.dts,d=l;else{if(!d){console.log("We've encountered a nal unit without data. See mux.js#233.");break}a.pts=d.pts,a.dts=d.dts}h.push(a)}return h},p=function(t,e,i){var n=e,a=i.defaultSampleDuration||0,r=i.defaultSampleSize||0,o=i.trackId,d=[];return t.forEach(function(t){var e=s.parseTrun(t),i=e.samples;i.forEach(function(t){void 0===t.duration&&(t.duration=a),void 0===t.size&&(t.size=r),t.trackId=o,t.dts=n,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),t.pts=n+t.compositionTimeOffset,n+=t.duration}),d=d.concat(i)}),d},h=function(t,e){var i=r.findBox(t,["moof","traf"]),n=r.findBox(t,["mdat"]),a={},o=[];return n.forEach(function(t,e){var n=i[e];o.push({mdat:t,traf:n})}),o.forEach(function(t){var i,n,o=t.mdat,h=t.traf,u=r.findBox(h,["tfhd"]),l=s.parseTfhd(u[0]),c=l.trackId,f=r.findBox(h,["tfdt"]),m=f.length>0?s.parseTfdt(f[0]).baseMediaDecodeTime:0,g=r.findBox(h,["trun"]);e===c&&g.length>0&&(i=p(g,m,l),n=d(o,i,c),a[c]||(a[c]=[]),a[c]=a[c].concat(n))}),a},u=function(t,e,i){var n;return null===e?null:(n=h(t,e),{seiNals:n[e],timescale:i})},l=function(){var t,e,i,n,r,s,o=!1;this.isInitialized=function(){return o},this.init=function(e){t=new a,o=!0,s=!!e&&e.isPartial,t.on("data",function(t){t.startTime=t.startPts/n,t.endTime=t.endPts/n,r.captions.push(t),r.captionStreams[t.stream]=!0})},this.isNewInit=function(t,e){return!(t&&0===t.length||e&&"object"==typeof e&&0===Object.keys(e).length)&&(i!==t[0]||n!==e[i])},this.parse=function(t,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],n=s[i];else if(null===i||!n)return e.push(t),null;for(;e.length>0;){var d=e.shift();this.parse(d,a,s)}return null!==(o=u(t,i,n))&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):null},this.pushNals=function(e){if(!this.isInitialized()||!e||0===e.length)return null;e.forEach(function(e){t.push(e)})},this.flushStream=function(){if(!this.isInitialized())return null;s?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){e=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()};e.exports=l},{16:16,28:28,35:35,37:37}],25:[function(t,e,i){var n=function(t){var e,i,n=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,n.byteLength=0,e=0;e<t.length;e++)i=t[e],"access_unit_delimiter_rbsp"===i.nalUnitType?(n.length&&(n.duration=i.dts-n.dts,a.byteLength+=n.byteLength,a.nalCount+=n.length,a.duration+=n.duration,a.push(n)),n=[i],n.byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return a.length&&(!n.duration||n.duration<=0)&&(n.duration=a[a.length-1].duration),a.byteLength+=n.byteLength,a.nalCount+=n.length,a.duration+=n.duration,a.push(n),a},a=function(t){var e,i,n=[],a=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=t[0].pts,a.dts=t[0].dts,e=0;e<t.length;e++)i=t[e],i.keyFrame?(n.length&&(a.push(n),a.byteLength+=n.byteLength,a.nalCount+=n.nalCount,a.duration+=n.duration),n=[i],n.nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return a.length&&n.duration<=0&&(n.duration=a[a.length-1].duration),a.byteLength+=n.byteLength,a.nalCount+=n.nalCount,a.duration+=n.duration,a.push(n),a},r=function(t){var e;return!t[0][0].keyFrame&&t.length>1&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},s=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},o=function(t,e){var i=s();return i.dataOffset=e,i.compositionTimeOffset=t.pts-t.dts,i.duration=t.duration,i.size=4*t.length,i.size+=t.byteLength,t.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},d=function(t,e){var i,n,a,r,s,d=e||0,p=[];for(i=0;i<t.length;i++)for(r=t[i],n=0;n<r.length;n++)s=r[n],a=o(s,d),d+=a.size,p.push(a);return p},p=function(t){var e,i,n,a,r,s,o=0,d=t.byteLength,p=t.nalCount,h=d+4*p,u=new Uint8Array(h),l=new DataView(u.buffer);for(e=0;e<t.length;e++)for(a=t[e],i=0;i<a.length;i++)for(r=a[i],n=0;n<r.length;n++)s=r[n],l.setUint32(o,s.data.byteLength),o+=4,u.set(s.data,o),o+=s.data.byteLength;return u},h=function(t,e){var i,n=e||0,a=[];return i=o(t,n),a.push(i),a},u=function(t){var e,i,n=0,a=t.byteLength,r=t.length,s=a+4*r,o=new Uint8Array(s),d=new DataView(o.buffer);for(e=0;e<t.length;e++)i=t[e],d.setUint32(n,i.data.byteLength),n+=4,o.set(i.data,n),n+=i.data.byteLength;return o};e.exports={groupNalsIntoFrames:n,groupFramesIntoGops:a,extendFirstKeyFrame:r,generateSampleTable:d,concatenateNalData:p,generateSampleTableForFrame:h,concatenateNalDataForFrame:u}},{}],26:[function(t,e,i){e.exports={generator:t(27),probe:t(28),Transmuxer:t(30).Transmuxer,AudioSegmentStream:t(30).AudioSegmentStream,VideoSegmentStream:t(30).VideoSegmentStream,CaptionParser:t(24)}},{24:24,27:27,28:28,30:30}],27:[function(t,e,i){"use strict";var n,a,r,s,o,d,p,h,u,l,c,f,m,g,y,b,S,v,T,_,w,k,U,A,D,C,x,I,O,L,P,E,M,R,B,F,N=Math.pow(2,32)-1;!function(){var t;if(U={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(t in U)U.hasOwnProperty(t)&&(U[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);A=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),C=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),D=new Uint8Array([0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),O={video:x,audio:I},E=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]),M=new Uint8Array([0,0,0,0,0,0,0,0]),R=M,B=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=M,L=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),n=function(t){var e,i,n,a=[],r=0;for(e=1;e<arguments.length;e++)a.push(arguments[e]);for(e=a.length;e--;)r+=a[e].byteLength;for(i=new Uint8Array(r+8),n=new DataView(i.buffer,i.byteOffset,i.byteLength),n.setUint32(0,i.byteLength),i.set(t,4),e=0,r=8;e<a.length;e++)i.set(a[e],r),r+=a[e].byteLength;return i},a=function(){return n(U.dinf,n(U.dref,E))},r=function(t){return n(U.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},s=function(){return n(U.ftyp,A,D,A,C)},b=function(t){return n(U.hdlr,O[t])},o=function(t){return n(U.mdat,t)},y=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),n(U.mdhd,e)},g=function(t){return n(U.mdia,y(t),b(t.type),p(t))},d=function(t){return n(U.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},p=function(t){return n(U.minf,"video"===t.type?n(U.vmhd,L):n(U.smhd,P),a(),v(t))},h=function(t,e){for(var i=[],a=e.length;a--;)i[a]=_(e[a]);return n.apply(null,[U.moof,d(t)].concat(i))},u=function(t){for(var e=t.length,i=[];e--;)i[e]=f(t[e]);return n.apply(null,[U.moov,c(4294967295)].concat(i).concat(l(t)))},l=function(t){for(var e=t.length,i=[];e--;)i[e]=w(t[e]);return n.apply(null,[U.mvex].concat(i))},c=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(U.mvhd,e)},S=function(t){var e,i,a=t.samples||[],r=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)e=a[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return n(U.sdtp,r)},v=function(t){return n(U.stbl,T(t),n(U.stts,F),n(U.stsc,R),n(U.stsz,B),n(U.stco,M))},function(){var t,e;T=function(i){return n(U.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===i.type?t(i):e(i))},t=function(t){var e,i,a=t.sps||[],r=t.pps||[],s=[],o=[];for(e=0;e<a.length;e++)s.push((65280&a[e].byteLength)>>>8),s.push(255&a[e].byteLength),s=s.concat(Array.prototype.slice.call(a[e]));for(e=0;e<r.length;e++)o.push((65280&r[e].byteLength)>>>8),o.push(255&r[e].byteLength),o=o.concat(Array.prototype.slice.call(r[e]));if(i=[U.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(U.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([a.length],s,[r.length],o))),n(U.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],t.sarRatio){var d=t.sarRatio[0],p=t.sarRatio[1];i.push(n(U.pasp,new Uint8Array([(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d,(4278190080&p)>>24,(16711680&p)>>16,(65280&p)>>8,255&p])))}return n.apply(null,i)},e=function(t){return n(U.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),r(t))}}(),m=function(t){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return n(U.tkhd,e)},_=function(t){var e,i,a,r,s,o,d;return e=n(U.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(t.baseMediaDecodeTime/(N+1)),d=Math.floor(t.baseMediaDecodeTime%(N+1)),i=n(U.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o,d>>>24&255,d>>>16&255,d>>>8&255,255&d])),s=92,"audio"===t.type?(a=k(t,s),n(U.traf,e,i,a)):(r=S(t),a=k(t,r.length+s),n(U.traf,e,i,a,r))},f=function(t){return t.duration=t.duration||4294967295,n(U.trak,m(t),g(t))},w=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),n(U.trex,e)},function(){var t,e,i;i=function(t,e){var i=0,n=0,a=0,r=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(a=4),void 0!==t[0].compositionTimeOffset&&(r=8)),[0,0,i|n|a|r,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},e=function(t,e){var a,r,s,o,d,p;for(o=t.samples||[],e+=20+16*o.length,s=i(o,e),r=new Uint8Array(s.length+16*o.length),r.set(s),a=s.length,p=0;p<o.length;p++)d=o[p],r[a++]=(4278190080&d.duration)>>>24,r[a++]=(16711680&d.duration)>>>16,r[a++]=(65280&d.duration)>>>8,r[a++]=255&d.duration,r[a++]=(4278190080&d.size)>>>24,r[a++]=(16711680&d.size)>>>16,r[a++]=(65280&d.size)>>>8,r[a++]=255&d.size,r[a++]=d.flags.isLeading<<2|d.flags.dependsOn,r[a++]=d.flags.isDependedOn<<6|d.flags.hasRedundancy<<4|d.flags.paddingValue<<1|d.flags.isNonSyncSample,r[a++]=61440&d.flags.degradationPriority,r[a++]=15&d.flags.degradationPriority,r[a++]=(4278190080&d.compositionTimeOffset)>>>24,r[a++]=(16711680&d.compositionTimeOffset)>>>16,r[a++]=(65280&d.compositionTimeOffset)>>>8,r[a++]=255&d.compositionTimeOffset;return n(U.trun,r)},t=function(t,e){var a,r,s,o,d,p;for(o=t.samples||[],e+=20+8*o.length,s=i(o,e),a=new Uint8Array(s.length+8*o.length),a.set(s),r=s.length,p=0;p<o.length;p++)d=o[p],a[r++]=(4278190080&d.duration)>>>24,a[r++]=(16711680&d.duration)>>>16,a[r++]=(65280&d.duration)>>>8,a[r++]=255&d.duration,a[r++]=(4278190080&d.size)>>>24,a[r++]=(16711680&d.size)>>>16,a[r++]=(65280&d.size)>>>8,a[r++]=255&d.size;return n(U.trun,a)},k=function(i,n){return"audio"===i.type?t(i,n):e(i,n)}}(),e.exports={ftyp:s,mdat:o,moof:h,moov:u,initSegment:function(t){var e,i=s(),n=u(t);return e=new Uint8Array(i.byteLength+n.byteLength),e.set(i),e.set(n,i.byteLength),e}}},{}],28:[function(t,e,i){"use strict";var n,a,r,s,o,d=t(39).toUnsigned,p=t(39).toHexString,h=t(37);n=function(t){var e={};return h.findBox(t,["moov","trak"]).reduce(function(t,e){var i,n,a,r,s;return(i=h.findBox(e,["tkhd"])[0])?(n=i[0],a=0===n?12:20,r=d(i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3]),(s=h.findBox(e,["mdia","mdhd"])[0])?(n=s[0],a=0===n?12:20,t[r]=d(s[a]<<24|s[a+1]<<16|s[a+2]<<8|s[a+3]),t):null):null},e)},a=function(t,e){var i,n,a;return i=h.findBox(e,["moof","traf"]),n=[].concat.apply([],i.map(function(e){return h.findBox(e,["tfhd"]).map(function(i){var n,a,r;return n=d(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),a=t[n]||9e4,r=h.findBox(e,["tfdt"]).map(function(t){var e,i;return e=t[0],i=d(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),1===e&&(i*=Math.pow(2,32),i+=d(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),i})[0],(r=r||1/0)/a})})),a=Math.min.apply(null,n),isFinite(a)?a:0},r=function(t,e){var i,n=h.findBox(e,["moof","traf"]),a=0,r=0;if(n&&n.length)for(var s=h.parseTraf(n[0]),o=0;o<s.boxes.length;o++)"tfhd"===s.boxes[o].type?i=s.boxes[o].trackId:"tfdt"===s.boxes[o].type?a=s.boxes[o].baseMediaDecodeTime:"trun"===s.boxes[o].type&&s.boxes[o].samples.length&&(r=s.boxes[o].samples[0].compositionTimeOffset||0);return(a+r)/(t[i]||9e4)},s=function(t){var e=h.findBox(t,["moov","trak"]),i=[];return e.forEach(function(t){var e=h.findBox(t,["mdia","hdlr"]),n=h.findBox(t,["tkhd"]);e.forEach(function(t,e){var a,r,s,o=h.parseType(t.subarray(8,12)),d=n[e];"vide"===o&&(a=new DataView(d.buffer,d.byteOffset,d.byteLength),r=a.getUint8(0),s=0===r?a.getUint32(12):a.getUint32(20),i.push(s))})}),i},o=function(t){var e=h.findBox(t,["moov","trak"]),i=[];return e.forEach(function(t){var e,n,a={},r=h.findBox(t,["tkhd"])[0];r&&(e=new DataView(r.buffer,r.byteOffset,r.byteLength),n=e.getUint8(0),a.id=0===n?e.getUint32(12):e.getUint32(20));var s=h.findBox(t,["mdia","hdlr"])[0];if(s){var o=h.parseType(s.subarray(8,12));a.type="vide"===o?"video":"soun"===o?"audio":o}var u=h.findBox(t,["mdia","minf","stbl","stsd"])[0];if(u){var l=u.subarray(8);a.codec=h.parseType(l.subarray(4,8));var c,f,m=h.findBox(l,[a.codec])[0];m&&(/^[a-z]vc[1-9]$/i.test(a.codec)?(c=m.subarray(78),f=h.parseType(c.subarray(4,8)),"avcC"===f&&c.length>11?(a.codec+=".",a.codec+=p(c[9]),a.codec+=p(c[10]),a.codec+=p(c[11])):a.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(a.codec)&&(c=m.subarray(28),f=h.parseType(c.subarray(4,8)),"esds"===f&&c.length>20&&0!==c[19]?(a.codec+="."+p(c[19]),a.codec+="."+p(c[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2"))}var g=h.findBox(t,["mdia","mdhd"])[0];if(g&&r){var y=0===n?12:20;a.timescale=d(g[y]<<24|g[y+1]<<16|g[y+2]<<8|g[y+3])}i.push(a)}),i},e.exports={findBox:h.findBox,parseType:h.parseType,timescale:n,startTime:a,compositionStartTime:r,videoTrackIds:s,tracks:o}},{37:37,39:39}],29:[function(t,e,i){var n=t(40).ONE_SECOND_IN_TS,a=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))},r=function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},s=function(t,e){var i,a,r=t.minSegmentDts;return e||(r-=t.timelineStartInfo.dts),i=t.timelineStartInfo.baseMediaDecodeTime,i+=r,i=Math.max(0,i),"audio"===t.type&&(a=t.samplerate/n,i*=a,i=Math.floor(i)),i};e.exports={clearDtsInfo:r,calculateTrackBaseMediaDecodeTime:s,collectDtsInfo:a}},{40:40}],30:[function(t,e,i){"use strict";var n,a,r,s,o=t(42),d=t(27),p=t(25),h=t(23),u=t(29),l=t(18),c=t(40),f=t(3),m=t(4).H264Stream,g=t(1),y=t(2).isLikelyAacData,b=t(40).ONE_SECOND_IN_TS,S=t(6),v=t(7),T=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},_=function(t,e,i,n,a,r){return{start:{dts:t,pts:t+(i-e)},end:{dts:t+(n-e),pts:t+(a-i)},prependedContentDuration:r,baseMediaDecodeTime:t}};a=function(t,e){var i=[],n=0,r=0,s=0,o=1/0;e=e||{},a.prototype.init.call(this),this.push=function(e){u.collectDtsInfo(t,e),t&&S.forEach(function(i){t[i]=e[i]}),i.push(e)},this.setEarliestDts=function(t){r=t},this.setVideoBaseMediaDecodeTime=function(t){o=t},this.setAudioAppendStart=function(t){s=t},this.flush=function(){var a,p,l,c,f;if(0===i.length)return void this.trigger("done","AudioSegmentStream");a=h.trimAdtsFramesByEarliestDts(i,t,r),t.baseMediaDecodeTime=u.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),h.prefixWithSilence(t,a,s,o),t.samples=h.generateSampleTable(a),l=d.mdat(h.concatenateFrameData(a)),i=[],p=d.moof(n,[t]),c=new Uint8Array(p.byteLength+l.byteLength),n++,c.set(p),c.set(l,p.byteLength),u.clearDtsInfo(t),f=Math.ceil(1024*b/t.samplerate),a.length&&this.trigger("timingInfo",{start:a[0].pts,end:a[0].pts+a.length*f}),this.trigger("data",{track:t,boxes:c}),this.trigger("done","AudioSegmentStream")},this.reset=function(){u.clearDtsInfo(t),i=[],this.trigger("reset")}},a.prototype=new o,n=function(t,e){var i,a,r=0,s=[],o=[];e=e||{},n.prototype.init.call(this),delete t.minPTS,this.gopCache_=[],this.push=function(e){u.collectDtsInfo(t,e),"seq_parameter_set_rbsp"!==e.nalUnitType||i||(i=e.config,t.sps=[e.data],v.forEach(function(e){t[e]=i[e]},this)),"pic_parameter_set_rbsp"!==e.nalUnitType||a||(a=e.data,t.pps=[e.data]),s.push(e),"end_of_seq_rbsp"===e.nalUnitType&&this.flush()},this.flush=function(){for(var i,n,a,h,l,c,f,m,g=0;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=p.groupNalsIntoFrames(s),a=p.groupFramesIntoGops(i),a[0][0].keyFrame||(n=this.getGopForFusion_(s[0],t),n?(g=n.duration,a.unshift(n),a.byteLength+=n.byteLength,a.nalCount+=n.nalCount,a.pts=n.pts,a.dts=n.dts,a.duration+=n.duration):a=p.extendFirstKeyFrame(a)),o.length){var y;if(!(y=e.alignGopsAtEnd?this.alignGopsAtEnd_(a):this.alignGopsAtStart_(a)))return this.gopCache_.unshift({gop:a.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");u.clearDtsInfo(t),a=y}u.collectDtsInfo(t,a),t.samples=p.generateSampleTable(a),l=d.mdat(p.concatenateNalData(a)),t.baseMediaDecodeTime=u.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),this.trigger("processedGopsInfo",a.map(function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}})),f=a[0],m=a[a.length-1],this.trigger("segmentTimingInfo",_(t.baseMediaDecodeTime,f.dts,f.pts,m.dts+m.duration,m.pts+m.duration,g)),this.trigger("timingInfo",{start:a[0].pts,end:a[a.length-1].pts+a[a.length-1].duration}),this.gopCache_.unshift({gop:a.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",t.baseMediaDecodeTime),this.trigger("timelineStartInfo",t.timelineStartInfo),h=d.moof(r,[t]),c=new Uint8Array(h.byteLength+l.byteLength),r++,c.set(h),c.set(l,h.byteLength),this.trigger("data",{track:t,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,o.length=0,this.trigger("reset")},this.resetStream_=function(){u.clearDtsInfo(t),i=void 0,a=void 0},this.getGopForFusion_=function(e){var i,n,a,r,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)r=this.gopCache_[s],a=r.gop,t.pps&&T(t.pps[0],r.pps[0])&&t.sps&&T(t.sps[0],r.sps[0])&&(a.dts<t.timelineStartInfo.dts||(i=e.dts-a.dts-a.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=r,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(t){var e,i,n,a,r,s,d,p;for(r=t.byteLength,s=t.nalCount,d=t.duration,e=i=0;e<o.length&&i<t.length&&(n=o[e],a=t[i],n.pts!==a.pts);)a.pts>n.pts?e++:(i++,r-=a.byteLength,s-=a.nalCount,d-=a.duration);return 0===i?t:i===t.length?null:(p=t.slice(i),p.byteLength=r,p.duration=d,p.nalCount=s,p.pts=p[0].pts,p.dts=p[0].dts,p)},this.alignGopsAtEnd_=function(t){var e,i,n,a,r,s;for(e=o.length-1,i=t.length-1,r=null,s=!1;e>=0&&i>=0;){if(n=o[e],a=t[i],n.pts===a.pts){s=!0;break}n.pts>a.pts?e--:(e===o.length-1&&(r=i),i--)}if(!s&&null===r)return null;var d;if(0===(d=s?i:r))return t
;var p=t.slice(d),h=p.reduce(function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t},{byteLength:0,duration:0,nalCount:0});return p.byteLength=h.byteLength,p.duration=h.duration,p.nalCount=h.nalCount,p.pts=p[0].pts,p.dts=p[0].dts,p},this.alignGopsWith=function(t){o=t}},n.prototype=new o,s=function(t,e){this.numberOfTracks=0,this.metadataStream=e,t=t||{},void 0!==t.remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps?this.keepOriginalTimestamps=t.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,s.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track,this.pendingBoxes.push(t.boxes)),void("audio"===t.track.type&&(this.audioTrack=t.track,this.pendingBoxes.unshift(t.boxes))))}},s.prototype=new o,s.prototype.flush=function(t){var e,i,n,a,r=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return void(++this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,v.forEach(function(t){s.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,S.forEach(function(t){s.info[t]=this.audioTrack[t]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=d.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),a=0;a<this.pendingBoxes.length;a++)s.data.set(this.pendingBoxes[a],r),r+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)e=this.pendingCaptions[a],e.startTime=c.metadataTsToSeconds(e.startPts,o,this.keepOriginalTimestamps),e.endTime=c.metadataTsToSeconds(e.endPts,o,this.keepOriginalTimestamps),s.captionStreams[e.stream]=!0,s.captions.push(e);for(a=0;a<this.pendingMetadata.length;a++)i=this.pendingMetadata[a],i.cueTime=c.metadataTsToSeconds(i.pts,o,this.keepOriginalTimestamps),s.metadata.push(i);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),a=0;a<s.captions.length;a++)e=s.captions[a],this.trigger("caption",e);for(a=0;a<s.metadata.length;a++)i=s.metadata[a],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},s.prototype.setRemux=function(t){this.remuxTracks=t},r=function(t){var e,i,o=this,d=!0;r.prototype.init.call(this),t=t||{},this.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var n={};this.transmuxPipeline_=n,n.type="aac",n.metadataStream=new l.MetadataStream,n.aacStream=new g,n.audioTimestampRolloverStream=new l.TimestampRolloverStream("audio"),n.timedMetadataTimestampRolloverStream=new l.TimestampRolloverStream("timed-metadata"),n.adtsStream=new f,n.coalesceStream=new s(t,n.metadataStream),n.headOfPipeline=n.aacStream,n.aacStream.pipe(n.audioTimestampRolloverStream).pipe(n.adtsStream),n.aacStream.pipe(n.timedMetadataTimestampRolloverStream).pipe(n.metadataStream).pipe(n.coalesceStream),n.metadataStream.on("timestamp",function(t){n.aacStream.setTimestamp(t.timeStamp)}),n.aacStream.on("data",function(r){"timed-metadata"!==r.type||n.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:o.baseMediaDecodeTime},codec:"adts",type:"audio"},n.coalesceStream.numberOfTracks++,n.audioSegmentStream=new a(i,t),n.audioSegmentStream.on("timingInfo",o.trigger.bind(o,"audioTimingInfo")),n.adtsStream.pipe(n.audioSegmentStream).pipe(n.coalesceStream)),o.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}),n.coalesceStream.on("data",this.trigger.bind(this,"data")),n.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new l.MetadataStream,r.packetStream=new l.TransportPacketStream,r.parseStream=new l.TransportParseStream,r.elementaryStream=new l.ElementaryStream,r.timestampRolloverStream=new l.TimestampRolloverStream,r.adtsStream=new f,r.h264Stream=new m,r.captionStream=new l.CaptionStream,r.coalesceStream=new s(t,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var d,p=t.keepOriginalTimestamps?0:o.baseMediaDecodeTime;if("metadata"===s.type){for(d=s.tracks.length;d--;)e||"video"!==s.tracks[d].type?i||"audio"!==s.tracks[d].type||(i=s.tracks[d],i.timelineStartInfo.baseMediaDecodeTime=p):(e=s.tracks[d],e.timelineStartInfo.baseMediaDecodeTime=p);e&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new n(e,t),r.videoSegmentStream.on("timelineStartInfo",function(t){i&&(i.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-o.baseMediaDecodeTime)),o.trigger("timelineStartInfo",t)}),r.videoSegmentStream.on("processedGopsInfo",o.trigger.bind(o,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",o.trigger.bind(o,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(t){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(t),o.trigger("baseMediaDecodeTime",t)}),r.videoSegmentStream.on("timingInfo",o.trigger.bind(o,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new a(i,t),r.audioSegmentStream.on("timingInfo",o.trigger.bind(o,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),o.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(t){t.dispatchType=r.metadataStream.dispatchType,o.trigger("id3Frame",t)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(t){var n=this.transmuxPipeline_;this.baseMediaDecodeTime=t,i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,u.clearDtsInfo(i),n.audioTimestampRolloverStream&&n.audioTimestampRolloverStream.discontinuity()),e&&(n.videoSegmentStream&&(n.videoSegmentStream.gopCache_=[]),e.timelineStartInfo.dts=void 0,e.timelineStartInfo.pts=void 0,u.clearDtsInfo(e),n.captionStream.reset()),n.timestampRolloverStream&&n.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.setRemux=function(e){var i=this.transmuxPipeline_;t.remux=e,i&&i.coalesceStream&&i.coalesceStream.setRemux(e)},this.alignGopsWith=function(t){e&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.push=function(t){if(d){var e=y(t);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),d=!1}this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){d=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},r.prototype=new o,e.exports={Transmuxer:r,VideoSegmentStream:n,AudioSegmentStream:a,AUDIO_PROPERTIES:S,VIDEO_PROPERTIES:v,generateVideoSegmentTimingInfo:_}},{1:1,18:18,2:2,23:23,25:25,27:27,29:29,3:3,4:4,40:40,42:42,6:6,7:7}],31:[function(t,e,i){"use strict";var n=t(42),a=t(27),r=t(23),s=t(29),o=t(40).ONE_SECOND_IN_TS,d=t(6),p=function(t,e){var i=[],n=0,h=0,u=0,l=1/0,c=null,f=null;e=e||{},p.prototype.init.call(this),this.push=function(e){s.collectDtsInfo(t,e),t&&d.forEach(function(i){t[i]=e[i]}),i.push(e)},this.setEarliestDts=function(t){h=t},this.setVideoBaseMediaDecodeTime=function(t){l=t},this.setAudioAppendStart=function(t){u=t},this.processFrames_=function(){var d,p,m,g,y;0!==i.length&&(d=r.trimAdtsFramesByEarliestDts(i,t,h),0!==d.length&&(t.baseMediaDecodeTime=s.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),r.prefixWithSilence(t,d,u,l),t.samples=r.generateSampleTable(d),m=a.mdat(r.concatenateFrameData(d)),i=[],p=a.moof(n,[t]),n++,t.initSegment=a.initSegment([t]),g=new Uint8Array(p.byteLength+m.byteLength),g.set(p),g.set(m,p.byteLength),s.clearDtsInfo(t),null===c&&(f=c=d[0].pts),f+=d.length*(1024*o/t.samplerate),y={start:c},this.trigger("timingInfo",y),this.trigger("data",{track:t,boxes:g})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:c,end:f}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){s.clearDtsInfo(t),c=null,f=null},this.reset=function(){this.resetTiming_(),i=[],this.trigger("reset")}};p.prototype=new n,e.exports=p},{23:23,27:27,29:29,40:40,42:42,6:6}],32:[function(t,e,i){e.exports={Transmuxer:t(33)}},{33:33}],33:[function(t,e,i){var n=t(42),a=t(18),r=t(5),s=t(31),o=t(34),d=t(29),p=t(2).isLikelyAacData,h=t(3),u=t(1),l=t(40),c=function(t){return t.prototype=new n,t.prototype.init.call(t),t},f=function(t){var e={type:"ts",tracks:{audio:null,video:null},packet:new a.TransportPacketStream,parse:new a.TransportParseStream,elementary:new a.ElementaryStream,timestampRollover:new a.TimestampRolloverStream,adts:new r.Adts,h264:new r.h264.H264Stream,captionStream:new a.CaptionStream,metadataStream:new a.MetadataStream};return e.headOfPipeline=e.packet,e.packet.pipe(e.parse).pipe(e.elementary).pipe(e.timestampRollover),e.timestampRollover.pipe(e.h264),e.h264.pipe(e.captionStream),e.timestampRollover.pipe(e.metadataStream),e.timestampRollover.pipe(e.adts),e.elementary.on("data",function(i){if("metadata"===i.type){for(var n=0;n<i.tracks.length;n++)e.tracks[i.tracks[n].type]||(e.tracks[i.tracks[n].type]=i.tracks[n]);e.tracks.video&&!e.videoSegmentStream&&(e.videoSegmentStream=new o(e.tracks.video,t),e.videoSegmentStream.on("timelineStartInfo",function(i){e.tracks.audio&&e.audioSegmentStream.setEarliestDts(i.dts-t.baseMediaDecodeTime)}),e.videoSegmentStream.on("timingInfo",e.trigger.bind(e,"videoTimingInfo")),e.videoSegmentStream.on("data",function(t){e.trigger("data",{type:"video",data:t})}),e.videoSegmentStream.on("done",e.trigger.bind(e,"done")),e.videoSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.videoSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.h264.pipe(e.videoSegmentStream)),e.tracks.audio&&!e.audioSegmentStream&&(e.audioSegmentStream=new s(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adts.pipe(e.audioSegmentStream)),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video})}}),e.captionStream.on("data",function(i){var n;n=e.tracks.video?e.tracks.video.timelineStartInfo.pts||0:0,i.startTime=l.metadataTsToSeconds(i.startPts,n,t.keepOriginalTimestamps),i.endTime=l.metadataTsToSeconds(i.endPts,n,t.keepOriginalTimestamps),e.trigger("caption",i)}),e=c(e),e.metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},m=function(t){var e={type:"aac",tracks:{audio:null},metadataStream:new a.MetadataStream,aacStream:new u,audioRollover:new a.TimestampRolloverStream("audio"),timedMetadataRollover:new a.TimestampRolloverStream("timed-metadata"),adtsStream:new h(!0)};return e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioRollover).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(i){"timed-metadata"!==i.type||e.audioSegmentStream||(e.tracks.audio=e.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:t.keepOriginalTimestamps?0:t.baseMediaDecodeTime},codec:"adts",type:"audio"},e.audioSegmentStream=new s(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video}))}),e=c(e),e.metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},g=function(t,e){t.on("data",e.trigger.bind(e,"data")),t.on("done",e.trigger.bind(e,"done")),t.on("partialdone",e.trigger.bind(e,"partialdone")),t.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),t.on("audioTimingInfo",e.trigger.bind(e,"audioTimingInfo")),t.on("videoTimingInfo",e.trigger.bind(e,"videoTimingInfo")),t.on("trackinfo",e.trigger.bind(e,"trackinfo")),t.on("id3Frame",function(i){i.dispatchType=t.metadataStream.dispatchType,i.cueTime=l.videoTsToSeconds(i.pts),e.trigger("id3Frame",i)}),t.on("caption",function(t){e.trigger("caption",t)})},y=function(t){var e=null,i=!0;t=t||{},y.prototype.init.call(this),t.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.push=function(n){if(i){var a=p(n);!a||e&&"aac"===e.type?a||e&&"ts"===e.type||(e=f(t),g(e,this)):(e=m(t),g(e,this)),i=!1}e.headOfPipeline.push(n)},this.flush=function(){e&&(i=!0,e.headOfPipeline.flush())},this.partialFlush=function(){e&&e.headOfPipeline.partialFlush()},this.endTimeline=function(){e&&e.headOfPipeline.endTimeline()},this.reset=function(){e&&e.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(i){t.baseMediaDecodeTime=i,e&&(e.tracks.audio&&(e.tracks.audio.timelineStartInfo.dts=void 0,e.tracks.audio.timelineStartInfo.pts=void 0,d.clearDtsInfo(e.tracks.audio),e.audioRollover&&e.audioRollover.discontinuity()),e.tracks.video&&(e.videoSegmentStream&&(e.videoSegmentStream.gopCache_=[]),e.tracks.video.timelineStartInfo.dts=void 0,e.tracks.video.timelineStartInfo.pts=void 0,d.clearDtsInfo(e.tracks.video)),e.timestampRollover&&e.timestampRollover.discontinuity())},this.setRemux=function(i){t.remux=i,e&&e.coalesceStream&&e.coalesceStream.setRemux(i)},this.setAudioAppendStart=function(t){e&&e.tracks.audio&&e.audioSegmentStream&&e.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){}};y.prototype=new n,e.exports=y},{1:1,18:18,2:2,29:29,3:3,31:31,34:34,40:40,42:42,5:5}],34:[function(t,e,i){"use strict";var n=t(42),a=t(27),r=t(29),s=t(25),o=t(7),d=function(t,e){var i,n,p,h=0,u=[],l=[],c=null,f=null,m=!0;e=e||{},d.prototype.init.call(this),this.push=function(e){r.collectDtsInfo(t,e),void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),"seq_parameter_set_rbsp"!==e.nalUnitType||i||(i=e.config,t.sps=[e.data],o.forEach(function(e){t[e]=i[e]},this)),"pic_parameter_set_rbsp"!==e.nalUnitType||n||(n=e.data,t.pps=[e.data]),u.push(e)},this.processNals_=function(i){var n;for(u=l.concat(u);u.length&&"access_unit_delimiter_rbsp"!==u[0].nalUnitType;)u.shift();if(0!==u.length){var o=s.groupNalsIntoFrames(u);if(o.length){if(l=o[o.length-1],i&&(o.pop(),o.duration-=l.duration,o.nalCount-=l.length,o.byteLength-=l.byteLength),!o.length)return void(u=[]);if(this.trigger("timelineStartInfo",t.timelineStartInfo),m){if(p=s.groupFramesIntoGops(o),!p[0][0].keyFrame){if(p=s.extendFirstKeyFrame(p),!p[0][0].keyFrame)return u=[].concat.apply([],o).concat(l),void(l=[]);o=[].concat.apply([],p),o.duration=p.duration}m=!1}for(null===c&&(c=o[0].pts,f=c),f+=o.duration,this.trigger("timingInfo",{start:c,end:f}),n=0;n<o.length;n++){var d=o[n];t.samples=s.generateSampleTableForFrame(d);var g=a.mdat(s.concatenateNalDataForFrame(d));r.clearDtsInfo(t),r.collectDtsInfo(t,d),t.baseMediaDecodeTime=r.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps);var y=a.moof(h,[t]);h++,t.initSegment=a.initSegment([t]);var b=new Uint8Array(y.byteLength+g.byteLength);b.set(y),b.set(g,y.byteLength),this.trigger("data",{track:t,boxes:b,sequence:h,videoFrameDts:d.dts,videoFramePts:d.pts})}u=[]}}},this.resetTimingAndConfig_=function(){i=void 0,n=void 0,c=null,f=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),l=[],u=[],m=!0,this.trigger("reset")}};d.prototype=new n,e.exports=d},{25:25,27:27,29:29,42:42,7:7}],35:[function(t,e,i){"use strict";var n=function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,a=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)a+=255,e++;if(a+=t[e++],!i.payload&&4===n){i.payloadType=n,i.payloadSize=a,i.payload=t.subarray(e,e+a);break}e+=a,n=0,a=0}return i},a=function(t){return 181!==t.payload[0]?null:49!=(t.payload[1]<<8|t.payload[2])?null:"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])?null:3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)},r=function(t,e){var i,n,a,r,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a=3*i,r={type:3&e[a+2],pts:t},4&e[a+2]&&(r.ccData=e[a+3]<<8|e[a+4],s.push(r));return s},s=function(t){for(var e,i,n=t.byteLength,a=[],r=1;r<n-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return t;e=n-a.length,i=new Uint8Array(e);var s=0;for(r=0;r<e;s++,r++)s===a[0]&&(s++,a.shift()),i[r]=t[s];return i};e.exports={parseSei:n,parseUserData:a,parseCaptionPackets:r,discardEmulationPreventionBytes:s,USER_DATA_REGISTERED_ITU_T_T35:4}},{}],36:[function(t,e,i){"use strict";var n={8:"audio",9:"video",18:"metadata"},a=function(t){return"0x"+("00"+t.toString(16)).slice(-2).toUpperCase()},r=function(t){for(var e,i=[];t.byteLength>0;)e=0,i.push(a(t[e++])),t=t.subarray(e);return i.join(" ")},s=function(t,e){var i=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=t[1]&parseInt("01111111",2)<<16|t[2]<<8|t[3];return e=e||{},e.avcPacketType=i[t[0]],e.CompositionTime=t[1]&parseInt("10000000",2)?-n:n,1===t[0]?e.nalUnitTypeRaw=r(t.subarray(4,100)):e.data=r(t.subarray(4)),e},o=function(t,e){var i=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],n=t[0]&parseInt("00001111",2);return e=e||{},e.frameType=i[(t[0]&parseInt("11110000",2))>>>4],e.codecID=n,7===n?s(t.subarray(1),e):e},d=function(t,e){var i=["AAC Sequence Header","AAC Raw"];return e=e||{},e.aacPacketType=i[t[0]],e.data=r(t.subarray(1)),e},p=function(t,e){var i=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],n=["5.5-kHz","11-kHz","22-kHz","44-kHz"],a=(t[0]&parseInt("11110000",2))>>>4;return e=e||{},e.soundFormat=i[a],e.soundRate=n[(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10===a?d(t.subarray(1),e):e},h=function(t){return{tagType:n[t[0]],dataSize:t[1]<<16|t[2]<<8|t[3],timestamp:t[7]<<24|t[4]<<16|t[5]<<8|t[6],streamID:t[8]<<16|t[9]<<8|t[10]}},u=function(t){var e=h(t);switch(t[0]){case 8:p(t.subarray(11),e);break;case 9:o(t.subarray(11),e)}return e},l=function(t){var e,i,n=9,a=[];for(n+=4;n<t.byteLength;)e=t[n+1]<<16,e|=t[n+2]<<8,e|=t[n+3],e+=11,i=t.subarray(n,n+e),a.push(u(i)),n+=e+4;return a},c=function(t){return JSON.stringify(t,null,2)};e.exports={inspectTag:u,inspect:l,textify:c}},{}],37:[function(t,e,i){"use strict";var n,a,r=t(39).toUnsigned,s=function(t){return new Date(1e3*t-20828448e5)},o=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},d=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),e+=String.fromCharCode(t[2]),e+=String.fromCharCode(t[3])},p=function(t,e){var i,n,a,s,o,h=[];if(!e.length)return null;for(i=0;i<t.byteLength;)n=r(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]),a=d(t.subarray(i+4,i+8)),s=n>1?i+n:t.byteLength,a===e[0]&&(1===e.length?h.push(t.subarray(i+8,s)):(o=p(t.subarray(i+8,s),e.slice(1)),o.length&&(h=h.concat(o)))),i=s;return h},h=function(t){var e,i,n=new DataView(t.buffer,t.byteOffset,t.byteLength),a=[];for(e=0;e+4<t.length;e+=i)if(i=n.getUint32(e),e+=4,i<=0)a.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&t[e]){case 1:a.push("slice_layer_without_partitioning_rbsp");break;case 5:a.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:a.push("sei_rbsp");break;case 7:a.push("seq_parameter_set_rbsp");break;case 8:a.push("pic_parameter_set_rbsp");break;case 9:a.push("access_unit_delimiter_rbsp");break;default:a.push("UNKNOWN NAL - "+t[e]&31)}return a},u={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:n(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,a,r=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},o=31&t[5];for(n=6,a=0;a<o;a++)i=r.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,a=0;a<e;a++)i=r.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:d(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(d(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:n(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:n(t.subarray(8))}},hdlr:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:d(t.subarray(8,12)),name:""},n=8;for(n=24;n<t.byteLength;n++){if(0===t[n]){n++;break}i.name+=String.fromCharCode(t[n])}return i.name=decodeURIComponent(escape(i.name)),i},mdat:function(t){return{byteLength:t.byteLength,nals:h(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,a={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===a.version?(n+=4,a.creationTime=s(i.getUint32(n)),n+=8,a.modificationTime=s(i.getUint32(n)),n+=4,a.timescale=i.getUint32(n),n+=8,a.duration=i.getUint32(n)):(a.creationTime=s(i.getUint32(n)),n+=4,a.modificationTime=s(i.getUint32(n)),n+=4,a.timescale=i.getUint32(n),n+=4,a.duration=i.getUint32(n)),n+=4,e=i.getUint16(n),a.language+=String.fromCharCode(96+(e>>10)),a.language+=String.fromCharCode(96+((992&e)>>5)),a.language+=String.fromCharCode(96+(31&e)),a},mdia:function(t){return{boxes:n(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:n(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return t.byteLength>28&&(i.streamDescriptor=n(t.subarray(28))[0]),i},moof:function(t){return{boxes:n(t)}},moov:function(t){return{boxes:n(t)}},mvex:function(t){return{boxes:n(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=s(e.getUint32(i)),i+=8,n.modificationTime=s(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8,n.duration=e.getUint32(i)):(n.creationTime=s(e.getUint32(i)),i+=4,n.modificationTime=s(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4,n.duration=e.getUint32(i)),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},a=i.getUint16(22);for(e=24;a;e+=12,a--)n.references.push({referenceType:(128&t[e])>>>7,referencedSize:2147483647&i.getUint32(e),subsegmentDuration:i.getUint32(e+4),startsWithSap:!!(128&t[e+8]),sapType:(112&t[e+8])>>>4,sapDeltaTime:268435455&i.getUint32(e+8)});return n},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:n(t)}},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},a=i.getUint32(4);for(e=8;a;e+=4,a--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),a={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)a.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return a},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:n(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},a=i.getUint32(4);for(e=8;a;e+=8,a--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return u.ftyp(t)},tfdt:function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:r(t[4]<<24|t[5]<<16|t[6]<<8|t[7])};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=r(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),e},tfhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},a=1&n.flags[2],r=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],d=32&n.flags[2],p=65536&n.flags[0],h=131072&n.flags[0];return e=8,a&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),r&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),o&&(n.defaultSampleSize=i.getUint32(e),e+=4),d&&(n.defaultSampleFlags=i.getUint32(e)),p&&(n.durationIsEmpty=!0),!a&&h&&(n.baseDataOffsetIsMoof=!0),n},tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=s(e.getUint32(i)),i+=8,n.modificationTime=s(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8,n.duration=e.getUint32(i)):(n.creationTime=s(e.getUint32(i)),i+=4,n.modificationTime=s(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4,n.duration=e.getUint32(i)),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/65536,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/65536,n},traf:function(t){return{boxes:n(t)}},trak:function(t){return{boxes:n(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),a=1&i.flags[2],r=4&i.flags[2],s=1&i.flags[1],d=2&i.flags[1],p=4&i.flags[1],h=8&i.flags[1],u=n.getUint32(4),l=8;for(a&&(i.dataOffset=n.getInt32(l),l+=4),r&&u&&(e={flags:o(t.subarray(l,l+4))},l+=4,s&&(e.duration=n.getUint32(l),l+=4),d&&(e.size=n.getUint32(l),l+=4),h&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e),u--);u--;)e={},s&&(e.duration=n.getUint32(l),l+=4),d&&(e.size=n.getUint32(l),l+=4),p&&(e.flags=o(t.subarray(l,l+4)),l+=4),h&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e);return i},"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}};n=function(t){for(var e,i,n,a,r,s=0,o=[],p=new ArrayBuffer(t.length),h=new Uint8Array(p),l=0;l<t.length;++l)h[l]=t[l]
;for(e=new DataView(p);s<t.byteLength;)i=e.getUint32(s),n=d(t.subarray(s+4,s+8)),a=i>1?s+i:t.byteLength,r=(u[n]||function(t){return{data:t}})(t.subarray(s+8,a)),r.size=i,r.type=n,o.push(r),s=a;return o},a=function(t,e){var i;return e=e||0,i=new Array(2*e+1).join(" "),t.map(function(t,n){return i+t.type+"\n"+Object.keys(t).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(e){var n=i+"  "+e+": ",a=t[e];if(a instanceof Uint8Array||a instanceof Uint32Array){var r=Array.prototype.slice.call(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return r?1===r.length?n+"<"+r.join("").slice(1)+">":n+"<\n"+r.map(function(t){return i+"  "+t}).join("\n")+"\n"+i+"  >":n+"<>"}return n+JSON.stringify(a,null,2).split("\n").map(function(t,e){return 0===e?t:i+"  "+t}).join("\n")}).join("\n")+(t.boxes?"\n"+a(t.boxes,e+1):"")}).join("\n")},e.exports={inspect:n,textify:a,parseType:d,findBox:p,parseTraf:u.traf,parseTfdt:u.tfdt,parseHdlr:u.hdlr,parseTfhd:u.tfhd,parseTrun:u.trun,parseSidx:u.sidx}},{39:39}],38:[function(t,e,i){"use strict";var n=t(21),a=t(22).handleRollover,r={};r.ts=t(20),r.aac=t(2);var s=t(40).ONE_SECOND_IN_TS,o=function(t,e){for(var i,n=0,a=188;a<t.byteLength;)if(71!==t[n]||71!==t[a])n++,a++;else{switch(i=t.subarray(n,a),r.ts.parseType(i,e.pid)){case"pat":e.pid||(e.pid=r.ts.parsePat(i));break;case"pmt":e.table||(e.table=r.ts.parsePmt(i))}if(e.pid&&e.table)return;n+=188,a+=188}},d=function(t,e,i){for(var n,a,s,o,d=0,p=188,h=!1;p<=t.byteLength;)if(71!==t[d]||71!==t[p]&&p!==t.byteLength)d++,p++;else{switch(n=t.subarray(d,p),r.ts.parseType(n,e.pid)){case"pes":a=r.ts.parsePesType(n,e.table),s=r.ts.parsePayloadUnitStartIndicator(n),"audio"===a&&s&&(o=r.ts.parsePesTime(n))&&(o.type="audio",i.audio.push(o),h=!0)}if(h)break;d+=188,p+=188}for(p=t.byteLength,d=p-188,h=!1;d>=0;)if(71!==t[d]||71!==t[p]&&p!==t.byteLength)d--,p--;else{switch(n=t.subarray(d,p),r.ts.parseType(n,e.pid)){case"pes":a=r.ts.parsePesType(n,e.table),s=r.ts.parsePayloadUnitStartIndicator(n),"audio"===a&&s&&(o=r.ts.parsePesTime(n))&&(o.type="audio",i.audio.push(o),h=!0)}if(h)break;d-=188,p-=188}},p=function(t,e,i){for(var n,a,s,o,d,p,h,u=0,l=188,c=!1,f={data:[],size:0};l<t.byteLength;)if(71!==t[u]||71!==t[l])u++,l++;else{switch(n=t.subarray(u,l),r.ts.parseType(n,e.pid)){case"pes":if(a=r.ts.parsePesType(n,e.table),s=r.ts.parsePayloadUnitStartIndicator(n),"video"===a&&(s&&!c&&(o=r.ts.parsePesTime(n))&&(o.type="video",i.video.push(o),c=!0),!i.firstKeyFrame)){if(s&&0!==f.size){for(d=new Uint8Array(f.size),p=0;f.data.length;)h=f.data.shift(),d.set(h,p),p+=h.byteLength;if(r.ts.videoPacketContainsKeyFrame(d)){var m=r.ts.parsePesTime(d);m?(i.firstKeyFrame=m,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}f.size=0}f.data.push(n),f.size+=n.byteLength}}if(c&&i.firstKeyFrame)break;u+=188,l+=188}for(l=t.byteLength,u=l-188,c=!1;u>=0;)if(71!==t[u]||71!==t[l])u--,l--;else{switch(n=t.subarray(u,l),r.ts.parseType(n,e.pid)){case"pes":a=r.ts.parsePesType(n,e.table),s=r.ts.parsePayloadUnitStartIndicator(n),"video"===a&&s&&(o=r.ts.parsePesTime(n))&&(o.type="video",i.video.push(o),c=!0)}if(c)break;u-=188,l-=188}},h=function(t,e){if(t.audio&&t.audio.length){var i=e;void 0===i&&(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=a(t.dts,i),t.pts=a(t.pts,i),t.dtsTime=t.dts/s,t.ptsTime=t.pts/s})}if(t.video&&t.video.length){var n=e;if(void 0===n&&(n=t.video[0].dts),t.video.forEach(function(t){t.dts=a(t.dts,n),t.pts=a(t.pts,n),t.dtsTime=t.dts/s,t.ptsTime=t.pts/s}),t.firstKeyFrame){var r=t.firstKeyFrame;r.dts=a(r.dts,n),r.pts=a(r.pts,n),r.dtsTime=r.dts/s,r.ptsTime=r.dts/s}}},u=function(t){for(var e,i=!1,n=0,a=null,o=null,d=0,p=0;t.length-p>=3;){switch(r.aac.parseType(t,p)){case"timed-metadata":if(t.length-p<10){i=!0;break}if((d=r.aac.parseId3TagSize(t,p))>t.length){i=!0;break}null===o&&(e=t.subarray(p,p+d),o=r.aac.parseAacTimestamp(e)),p+=d;break;case"audio":if(t.length-p<7){i=!0;break}if((d=r.aac.parseAdtsSize(t,p))>t.length){i=!0;break}null===a&&(e=t.subarray(p,p+d),a=r.aac.parseSampleRate(e)),n++,p+=d;break;default:p++}if(i)return null}if(null===a||null===o)return null;var h=s/a;return{audio:[{type:"audio",dts:o,pts:o},{type:"audio",dts:o+1024*n*h,pts:o+1024*n*h}]}},l=function(t){var e={pid:null,table:null},i={};o(t,e);for(var a in e.table)if(e.table.hasOwnProperty(a)){var r=e.table[a];switch(r){case n.H264_STREAM_TYPE:i.video=[],p(t,e,i),0===i.video.length&&delete i.video;break;case n.ADTS_STREAM_TYPE:i.audio=[],d(t,e,i),0===i.audio.length&&delete i.audio}}return i},c=function(t,e){var i,n=r.aac.isLikelyAacData(t);return(i=n?u(t):l(t))&&(i.audio||i.video)?(h(i,e),i):null};e.exports={inspect:c,parseAudioPes_:d}},{2:2,20:20,21:21,22:22,40:40}],39:[function(t,e,i){var n=function(t){return t>>>0},a=function(t){return("00"+t.toString(16)).slice(-2)};e.exports={toUnsigned:n,toHexString:a}},{}],40:[function(t,e,i){var n,a,r,s,o,d,p;n=function(t){return 9e4*t},a=function(t,e){return t*e},r=function(t){return t/9e4},s=function(t,e){return t/e},o=function(t,e){return n(s(t,e))},d=function(t,e){return a(r(t),e)},p=function(t,e,i){return r(i?t:t-e)},e.exports={ONE_SECOND_IN_TS:9e4,secondsToVideoTs:n,secondsToAudioTs:a,videoTsToSeconds:r,audioTsToSeconds:s,audioTsToVideoTs:o,videoTsToAudioTs:d,metadataTsToSeconds:p}},{}],41:[function(t,e,i){"use strict";var n;n=function(t){var e=t.byteLength,i=0,n=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+n},this.loadWord=function(){var a=t.byteLength-e,r=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw new Error("no bytes available");r.set(t.subarray(a,a+s)),i=new DataView(r.buffer).getUint32(0),n=8*s,e-=s},this.skipBits=function(t){var a;n>t?(i<<=t,n-=t):(t-=n,a=Math.floor(t/8),t-=8*a,e-=a,this.loadWord(),i<<=t,n-=t)},this.readBits=function(t){var a=Math.min(n,t),r=i>>>32-a;return n-=a,n>0?i<<=a:e>0&&this.loadWord(),a=t-a,a>0?r<<a|this.readBits(a):r},this.skipLeadingZeros=function(){var t;for(t=0;t<n;++t)if(0!=(i&2147483648>>>t))return i<<=t,n-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},e.exports=n},{}],42:[function(t,e,i){"use strict";var n=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var n;return!!t[e]&&(n=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(n,1),n>-1)},this.trigger=function(e){var i,n,a,r;if(i=t[e])if(2===arguments.length)for(a=i.length,n=0;n<a;++n)i[n].call(this,arguments[1]);else{for(r=[],n=arguments.length,n=1;n<arguments.length;++n)r.push(arguments[n]);for(a=i.length,n=0;n<a;++n)i[n].apply(this,r)}},this.dispose=function(){t={}}}};n.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(e){t.flush(e)}),this.on("partialdone",function(e){t.partialFlush(e)}),this.on("endedtimeline",function(e){t.endTimeline(e)}),this.on("reset",function(e){t.reset(e)}),t},n.prototype.push=function(t){this.trigger("data",t)},n.prototype.flush=function(t){this.trigger("done",t)},n.prototype.partialFlush=function(t){this.trigger("partialdone",t)},n.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},n.prototype.reset=function(t){this.trigger("reset",t)},e.exports=n},{}]},{},[15])(15)});
    </script>
    <script>
"use strict";
function makeStr(num) {
  let text = "";
  let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  for (let i = 0; i < num; i++) {
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  return text;
}

function toggleClass(s,n) {
  let elements = document.querySelectorAll(s);
  elements.forEach(element => {
    element.classList.toggle(n);
  });
}

function switchSource(e) {
  if(e.target && e.target.nodeName === "LI") {
    sourceReg =  e.target.classList[0].substring(7);
    updateAside();
    programId = undefined;
  }
}

function switchCategory(e) {
  if(e.target && e.target.nodeName === "LI") {
    let catValue =  e.target.dataset.value;
    switch (catValue) {
      case "0":
      case "1":
        if(catValue === "0") {
          e.target.textContent = '开灯';
          e.target.dataset.value = 1;
          localStorage.setItem('dark', 1);
        } else {
          e.target.textContent = '关灯';
          e.target.dataset.value = 0;
          localStorage.setItem('dark', 0);
        }
        toggleClass('li','white');
        toggleClass('button','white');
        toggleClass('input','white');
        toggleClass('a','white');
        toggleClass('body','bgBlack');
        toggleClass('input','bgBlack');
        toggleClass('footer','hidden');
        break;
      default:
        const selected = document.querySelector('.borderRed');
        if(selected) selected.classList.remove('borderRed');
        if (e.target.dataset.source) {
          sourceReg = e.target.dataset.source;
          programId = catValue;
          playVideo();
          const selected = document.querySelector('.selected');
          if(selected) selected.classList.remove('selected');
          e.target.classList.add('selected');
        } else {
          e.target.classList.add('borderRed');
          const mylist = document.querySelector('.'+catValue);
          let siblings = mylist.parentNode.childNodes;
          siblings.forEach(sibling => {
            if(sibling.nodeName === "UL") {
              sibling.classList.add('hidden');
            }
          });
          mylist.classList.remove('hidden');
        }
        break;
    }
  }
}

function switchChannel(e) {
  if(e.target) {
    if (e.target.nodeName === "LI") {
      sourceReg =  e.target.dataset.source;
      programId =  e.target.dataset.id;
      rate = e.target.dataset.rate;
      playVideo();
      const selected = document.querySelector('.selected');
      if(selected) selected.classList.remove('selected');
      e.target.classList.add('selected');
    } else if (e.target.nodeName === "SUB") {
      sourceReg =  e.target.parentNode.dataset.source;
      programId =  e.target.parentNode.dataset.id;
      playVideo();
      const selected = document.querySelector('.selected');
      if(selected) selected.classList.remove('selected');
      e.target.parentNode.classList.add('selected');
    }
  }
}

function tsLoad() {
  let tsUrl = hlsVideoUrl;
  const mediaSource = new MediaSource();
  hlsVideoUrl=URL.createObjectURL(mediaSource);
  videojsLoad();

  mediaSource.addEventListener("sourceopen", async () => {
    URL.revokeObjectURL(videojs('video').src);
    mediaSource.duration = 0;
    let receivedLength = 0;
    let chunksAll,count = 0,position = 0,chunks = [];
    let mime = 'video/mp4; codecs="mp4a.40.2,avc1.64001f"';
    let sourceBuffer = mediaSource.addSourceBuffer(mime);
    let transmuxer = new muxjs.mp4.Transmuxer();

    const fetchedResource = await fetch(tsUrl);
    const reader = await fetchedResource.body.getReader();

    sourceBuffer.addEventListener('updateend', () => {

      transmuxer.off('data');

      transmuxer.on('data', function(segment) {
        if (segment && segment.type === 'combined') {
          sourceBuffer.appendBuffer(new Uint8Array(segment.data));
        }
      })
    });

    transmuxer.on('data', function(segment) {
      if (segment && segment.type === 'combined') {
        let data = new Uint8Array(segment.initSegment.byteLength + segment.data.byteLength);
        data.set(segment.initSegment, 0);
        data.set(segment.data, segment.initSegment.byteLength);
        sourceBuffer.appendBuffer(data);
      }
    });

    reader.read().then(function processSegment({ done, value }) {
      if (done) {
        mediaSource.endOfStream();
        return
      }

      if (count === 0) {
        transmuxer.push(value);
        transmuxer.flush();
        count++;
      } else if (count < 700) {
        chunks.push(value);
        receivedLength += value.length;
        count++;
      } else {
        chunksAll = new Uint8Array(receivedLength);
        position = 0;
        for (let chunk of chunks) {
          chunksAll.set(chunk, position);
          position += chunk.length;
        }
        count = 1;
        chunks = [];
        receivedLength = 0;
        transmuxer.push(chunksAll);
        transmuxer.flush();
      }

      return reader.read().then(processSegment)
    });
  });
}

function videojsLoad() {
  if (videoField.hasChildNodes()) {
    videojs('video').dispose();
  }
  
  let contentType;
  if (hlsVideoUrl.indexOf('.m3u8') !== -1) {
    contentType = 'application/vnd.apple.mpegurl';
  } else if (hlsVideoUrl.indexOf('blob:') !== -1) {
    contentType = 'video/mp4';
  } else {
    contentType = 'video/x-flv';
  }
  const video = document.createElement('video');
  video.id = 'video';
  video.className = 'video-js';
  const noVideojs = document.createElement('p');
  noVideojs.className = 'vjs-no-js';
  const noVideojsText = document.createTextNode('港台节目直播、广电直播源');
  noVideojs.appendChild(noVideojsText);
  video.appendChild(noVideojs);
  videoField.appendChild(video);

  const player = videojs('video',{
    liveui: liveui,
    autoplay: 'true',
    preload: 'auto',
    playsinline: true,
    textTrackSettings: false,
    controls: true,
    fluid: true,
    responsive: true
  });

  player.src({
    src: hlsVideoUrl,
    type: contentType,
    overrideNative: true
  });

  player.ready(function() {
    let promise = player.play();

    if (promise !== undefined) {
      promise.then(function() {
        // Autoplay started!
      }).catch(function() {
        // Autoplay was prevented.
      });
    }
  });

  player.on('error', function(e) {
    let time = this.currentTime();
    if (this.error().code === 2) {
      alertInfo('频道发生错误！',10);
      this.error(null).pause().load().currentTime(time).play();
    } else if (this.error().code === 4) {
      if (hlsVideoUrl.indexOf('playtype=lookback') !== -1) {
        if (rate === 'org') {
          rate = 'hd';
          playBack(sourceReg);
        } else if (rate === 'hd') {
          rate = 'ld';
          playBack(sourceReg);
        } else if (rate === 'ld') {
          rate = 'sd';
          playBack(sourceReg);
        } else {
          alertInfo('录像还未准备好！',10);
        }
      } else if (hlsVideoUrl.indexOf('playtype=live') !== -1) {
        if (rate === 'org') {
          rate = 'hd';
          playVideo();
        } else if (rate === 'hd') {
          rate = 'ld';
          playVideo();
        } else if (rate === 'ld') {
          rate = 'sd';
          playVideo();
        } else {
          alertInfo('频道不可用！',10);
        }
      } else {
        alertInfo('频道不可用！',10);
      }
      /*
      if (programId) {
        localStorage.removeItem(sourceReg+'_acc');
        localStorage.removeItem(sourceReg+'_pwd');
        localStorage.removeItem(sourceReg+'_token');
        localStorage.removeItem(sourceReg+'_verify_code');
      }
      */
    } else {
      alertInfo('无法连接直播源！',10);
    }
  });
}

function playVideo() {
  if(!programId) {
    let keyArr = Object.keys(sourcesJsonParsed);
    let index,source;
    while ((index = keyArr.pop()) !== undefined) {
      if (sourcesJsonParsed[index].hasOwnProperty('channels') && sourcesJsonParsed[index].channels[0] && sourcesJsonParsed[index].channels[0].hasOwnProperty('url')) {
        if (sourcesJsonParsed[index].hasOwnProperty('feature') && sourcesJsonParsed[index].feature.chnl_name) {
          featureBtn.textContent = sourcesJsonParsed[index].feature.chnl_name;
          featureBtn.dataset.source = sourcesJsonParsed[index].feature.source_name;
          featureBtn.dataset.value = sourcesJsonParsed[index].feature.chnl_id;
        }
        if (sourcesJsonParsed[index].hasOwnProperty('ios') && videojs.browser.IS_IOS) {
          source = sourcesJsonParsed[index].ios;
        } else if (sourcesJsonParsed[index].hasOwnProperty('android') && videojs.browser.IS_ANDROID) {
          source = sourcesJsonParsed[index].android;
        } else if (sourcesJsonParsed[index].hasOwnProperty('default')) {
          source = sourcesJsonParsed[index].default;
        } else {
          source = sourcesJsonParsed[index].channels[0];
        }
        hlsVideoUrl = source.url;
        videojsLoad();
        if (sourcesJsonParsed[index].hasOwnProperty('overlay')) {
          videoOverlay(sourcesJsonParsed[index].overlay,source);
        }
        showSchedule(source.schedule);
        resetSourceReg();
        break;
      }
    }
  } else if (jsonChannels[sourceReg]) {
    hlsVideoUrl = jsonChannels[sourceReg][programId]['url'];
    videojsLoad();
    if (jsonChannels[sourceReg].hasOwnProperty('overlay')) {
      videoOverlay(jsonChannels[sourceReg].overlay,jsonChannels[sourceReg][programId]);
    }
    showSchedule(jsonChannels[sourceReg][programId].schedule);
    resetSourceReg();
  } else if (!sourcesJsonParsed.hasOwnProperty(sourceReg) || !sourcesJsonParsed[sourceReg].hasOwnProperty('channels')) {
    deleteSchedule();
    alertInfo('频道不可用！');
    resetSourceReg();
  } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('play_url')) {
    sourcesJsonParsed[sourceReg].channels.forEach(channel => {
      if (channel.chnl_id === programId) {
        hlsVideoUrl = channel.url;
        videojsLoad();
        if (sourcesJsonParsed[sourceReg].hasOwnProperty('overlay')) {
          videoOverlay(sourcesJsonParsed[sourceReg].overlay,channel);
        }
        showSchedule(channel.schedule);
        resetSourceReg();
      }
    });
  } else if (localStorage.getItem(sourceReg+'_token')) {
    if (sourcesJsonParsed[sourceReg].hasOwnProperty('auth_info_url') && sourcesJsonParsed[sourceReg].hasOwnProperty('auth_verify_url')) {
      reqAuth();
    } else {
      if (sourcesJsonParsed[sourceReg].hasOwnProperty('protocol') && sourcesJsonParsed[sourceReg].protocol) {
        protocol = sourcesJsonParsed[sourceReg].protocol;
      } else {
        protocol = 'hls';
      }
      if (localStorage.getItem(sourceReg+'_verify_code')) {
        hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol='+protocol+'&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&playtoken=ABCDEFGH&verifycode='+localStorage.getItem(sourceReg+'_verify_code')+'&rate='+rate+'&programid='+programId+'.m3u8';
      } else {
        hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol='+protocol+'&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&playtoken=ABCDEFGH&rate='+rate+'&programid='+programId+'.m3u8';
      }
      if (protocol === 'http') {
        tsLoad();
      } else {
        videojsLoad();
      }
      showSchedule();
      updateAside();
    }
  } else {
    deleteSchedule();
    alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源未注册或登录！',5);
    updateAside();
  }
}

function videoOverlay(sourceOverlay,channel) {
  let overlays = [],channelOverlay,channelOverlayArr = [];
  if (channel.hasOwnProperty('overlay') && channel.overlay.length > 0) {
    channelOverlay = channel.overlay;
    channelOverlayArr = channelOverlay.split(',');
  }
  sourceOverlay.forEach((sourceItem,sourceIndex) => {
    let overlayInfo = [];
    if (sourceItem.hasOwnProperty('force') && sourceItem.force === 1) {
      if (sourceItem.hasOwnProperty('switch') && sourceItem.switch === 'on') {
        overlays.push({class:'overlay'+sourceIndex.toString(),content:'',align:'center',start:'ready'});
        overlayInfo.push(sourceItem.height,sourceItem.width,sourceItem.margin_left,sourceItem.margin_top,sourceItem.height_fullscreen,sourceItem.width_fullscreen,sourceItem.margin_left_fullscreen,sourceItem.margin_top_fullscreen);
        overlaysInfo[sourceIndex] = overlayInfo;
      }
    } else if (channelOverlayArr.length > sourceIndex) {
      let channelOverlayIndex = channelOverlayArr[sourceIndex];
      if ((channelOverlayIndex === 'on' && sourceItem.reverse === 0) || (channelOverlayIndex === 'off' && sourceItem.reverse === 1)) {
        overlays.push({class:'overlay'+sourceIndex.toString(),content:'',align:'center',start:'ready'});
        overlayInfo.push(sourceItem.height,sourceItem.width,sourceItem.margin_left,sourceItem.margin_top,sourceItem.height_fullscreen,sourceItem.width_fullscreen,sourceItem.margin_left_fullscreen,sourceItem.margin_top_fullscreen);
        overlaysInfo[sourceIndex] = overlayInfo;
      } else if (channelOverlayIndex.indexOf(':') !== -1) {
        let channelOverlayIndexArr = channelOverlayIndex.split(':');
        if ((sourceItem.reverse === 0 && channelOverlayIndexArr[0] === 'on') || (sourceItem.reverse === 1 && channelOverlayIndexArr[0] === 'off')) {
          overlays.push({class:'overlay'+sourceIndex.toString(),content:'',align:'center',start:'ready'});
          channelOverlayIndexArr.shift();
          overlaysInfo[sourceIndex] = channelOverlayIndexArr;
        }
      }
    }
  });

  if (overlays.length > 0) {
    videoField.firstChild.classList.add('vjs-16-9');
    videojs('video').overlay({
      debug: false,
      overlays: overlays
    });
    for (let index = 0; index < overlays.length; index++) {
      const info = overlaysInfo[index];
      const overlayIndex = document.querySelector('.overlay'+index);
      overlayIndex.setAttribute('style', 'height:' + info[0] +'%; width: ' + info[1] + '%; margin-left: ' + info[2] + '%; margin-top: ' + info[3] + '%;');
    }
  }
}

function setOverlayFullscreen() {
  let width = window.screen.width * window.devicePixelRatio;
  let height = window.screen.height * window.devicePixelRatio;
  let videoWidth,videoHeight,newWidth,newHeight,marginLeft,marginTop;
  let videoWidthRes = videojs('video').videoWidth();
  let videoHeightRes = videojs('video').videoHeight();
  if (width > height && width / height !== 1.6) {
    videoHeight = height;
    videoWidth = videoHeight * videoWidthRes / videoHeightRes;
  } else {
    videoWidth = width;
    videoHeight = videoWidth * videoHeightRes / videoWidthRes;
  }

  for (let index = 0; index < Object.keys(overlaysInfo).length; index++) {
    const info = overlaysInfo[index];
    const overlayIndex = document.querySelector('.overlay'+index);
    if (overlayIndex) {
      if (document.fullscreenElement) {
        newHeight = Math.floor(videoHeight * info[4] / 100 / window.devicePixelRatio);
        newWidth = Math.floor(videoWidth * info[5] / 100 / window.devicePixelRatio);
        marginLeft = Math.floor(videoWidth * info[6] / 100 / window.devicePixelRatio);
        marginTop = Math.floor(videoHeight * info[7] / 100 / window.devicePixelRatio);
  
        overlayIndex.setAttribute('style', 'width:' + newWidth +'px; height: ' + newHeight + 'px; margin-left: ' + marginLeft + 'px; margin-top: ' + marginTop + 'px;');
      } else {
        overlayIndex.setAttribute('style', 'height:' + info[0] +'%; width: ' + info[1] + '%; margin-left: ' + info[2] + '%; margin-top: ' + info[3] + '%;');
      }
    }
  }
}

function timeoutPromise(ms, promise) {
  return new Promise((resolve, reject) => {
    const timeoutId = setTimeout(() => {
      reject(new Error('超时'));
    }, ms);
    promise.then(
      (res) => {
        clearTimeout(timeoutId);
        resolve(res);
      },
      (err) => {
        clearTimeout(timeoutId);
        reject(err);
      }
    );
  }).catch(console.log);
}

function reqData(url, data = '', method = 'GET') {
  return new Promise((resolve, reject) => {
    let config = {};
    if (method === 'GET') {
      if (urls.indexOf(url) !== -1) {
        config = { 
          method: method, 
          mode: "cors",
          cache: "no-cache",
          credentials: "omit",
          referrer: "",
        };
      } else {
        config = { 
          method: method, 
          mode: "cors",
          cache: "no-cache",
          credentials: "omit",
        };
      }
      fetch(url + data, config).then(response => {
        resolve(response.json());
      }).catch(err => {reject(err);});
    } else {
      if (urls.indexOf(url) !== -1) {
        config = { 
          method: method, 
          mode: "cors",
          cache: "no-cache",
          credentials: "omit",
          referrer: "",
          body: JSON.stringify(data),
        };
      } else {
        config = { 
          method: method, 
          mode: "cors",
          cache: "no-cache",
          credentials: "omit",
          body: JSON.stringify(data),
        };
      }
      fetch(url, config).then(response => {
        resolve(response.json());
      }).catch(err => {reject(err);});
    }
  }).catch(err => {
    console.log('连接 ' + url + ' 发生错误:', err.message);
  });
}

function alertInfo(text,delay=3) {
  alertField.textContent = text;
  setTimeout(function() {
    if (alertField.textContent === text) {
      alertField.textContent = '';
    }
  }, delay*1000);
}

function uniqueName() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('unique_url')) {
    reqData(sourcesJsonParsed[sourceReg].unique_url,'?accounttype='+sourcesJsonParsed[sourceReg].acc_type_reg+'&username='+regAccField.value)
    .then(response => {
      if (response.ret !== 0) {
        alertInfo('用户名已存在,请重新输入！',3);
      }
    });
  }
}

function regImg() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    let tokenUrl,imgUrl;
    tokenUrl = sourcesJsonParsed[sourceReg].token_url;
    imgUrl = sourcesJsonParsed[sourceReg].img_url;

    if (sourcesJsonParsed[sourceReg].hasOwnProperty('refresh_token_url')) {
      let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
      deviceno = deviceno+md5(deviceno).substring(7, 8);
      timeoutPromise(3000,reqData(tokenUrl,{"role":"guest","deviceno":deviceno,"deviceType":"yuj"},'POST'))
      .then(response => {
        if (response.ret !== 0) {
          alertInfo('验证码请求错误！');
        } else {
          reqData(sourcesJsonParsed[sourceReg].refresh_token_url,{"accessToken":response.accessToken,"refreshToken":response.refreshToken},'POST')
          .then(response => {
            if (response.ret !== 0) {
              alertInfo('验证码请求错误！');
            } else {
              reqData(imgUrl,'?accesstoken='+response.accessToken)
              .then(response => {
                const newImage = document.createElement('img');
                newImage.src = response.image.replace('\\','/');
                regImgField.innerHTML = newImage.outerHTML;
                regImgIdField.value = response.picid;
              });
            }
          });
        }
      }).catch(err => {
        alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源!', 10);
        console.log('请求 '+tokenUrl+' 发生错误:', err.message);
      });
    } else {
      timeoutPromise(3000,reqData(tokenUrl,{"usagescen":1},'POST'))
      .then(response => {
        if (response.ret !== 0) {
          alertInfo('验证码请求错误！');
        } else {
          reqData(imgUrl,'?accesstoken='+response.access_token)
          .then(response => {
            const newImage = document.createElement('img');
            newImage.src = response.image.replace('\\','/');
            regImgField.innerHTML = newImage.outerHTML;
            regImgIdField.value = response.picid;
          });
        }
      }).catch(err => {
        alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源!', 10);
        console.log('请求 '+tokenUrl+' 发生错误:', err.message);
      });
    }
  }
}

function reqSms() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('sms_url')) {
    let regAcc = regAccField.value;
    let regImgInput = regImgInputField.value;
    let regImgId = regImgIdField.value;

    reqData(sourcesJsonParsed[sourceReg].sms_url,'?pincode='+regImgInput+'&picid='+regImgId+'&verifytype=3&account='+regAcc+'&accounttype=1')
    .then(response => {
      if (response.ret !== 0) {
        alertInfo('验证码或其它错误！请重新输入！');
      } else {
        alertInfo('短信已发送！',5);
      }
    });
  }
}

function reqReg() {
  let acc = regAccField.value;
  acc = acc.toString();
  let pwd = regPwdField.value;
  let smsCode = regSmsField.value;

  if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    reqData(sourcesJsonParsed[sourceReg].reg_url,'?username='+acc+'&iconid=1&pwd='+md5(pwd)+'&birthday=1970-1-1&type=1&accounttype='+sourcesJsonParsed[sourceReg].acc_type_reg)
    .then(response => {
      if (response.ret !== 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc + '直播源注册失败，请重试！用户名不能是中文！');
      } else {
        formToggle.click();
        loginAccField.value = acc;
        loginPwdField.value = pwd;
        regAccField.value = '';
        regPwdField.value = '';
        regImgInputField.value = '';
        regSmsField.value = '';
        alertInfo('注册成功!');
        reqLogin();
      }
    });
  } else {
    reqData(sourcesJsonParsed[sourceReg].verify_url,'?verifycode='+smsCode+'&verifytype=3&username='+acc+'&account='+acc)
    .then(response => {
      if (response.ret === 0) {
        let user = {};
        user.account = acc;
        let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
        user.deviceno = deviceno+md5(deviceno).substring(7, 8);
        user.devicetype = 'yuj';
        user.code = response.code;
        let timestamp = Date.now();
        user.signature = md5(acc+'|'+md5(pwd)+'|'+user.deviceno+'|'+user.devicetype+'|'+timestamp);
        user.birthday = '1970-1-1';
        user.username = acc;
        user.type = 1;
        user.timestamp = timestamp.toString();
        user.pwd = md5(pwd);
        user.accounttype = sourcesJsonParsed[sourceReg].acc_type_reg;

        reqData(sourcesJsonParsed[sourceReg].reg_url,user,'POST')
        .then(response => {
          if (response.ret === 0) {
            formToggle.click();
            loginAccField.value = acc;
            loginPwdField.value = pwd;
            regAccField.value = '';
            regPwdField.value = '';
            regImgInputField.value = '';
            regSmsField.value = '';
            alertInfo('注册成功!');
            reqLogin();
          } else {
            alertInfo('注册失败,手机号已存在！', 10);
          }
        });
      } else {
        alertInfo('短信验证失败,请重试！');
      }
    });
  }
}

function reqLogin() {
  let acc = loginAccField.value;
  acc = acc.toString();
  let pwd = loginPwdField.value;
  let deviceno;
  deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
  deviceno = deviceno + md5(deviceno).substring(7, 8);
  let devicetype = 3;
  let isforce = 1;

  if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    reqData(sourcesJsonParsed[sourceReg].login_url,'?deviceno='+deviceno+'&devicetype='+devicetype+'&accounttype='+sourcesJsonParsed[sourceReg].acc_type_login+'&accesstoken=(null)&account='+acc+'&pwd='+md5(pwd)+'&isforce='+isforce)
    .then(response => {
      if (response.ret === 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录成功！',5);
        localStorage.setItem(sourceReg+'_acc', acc);
        localStorage.setItem(sourceReg+'_pwd', pwd);
        localStorage.setItem(sourceReg+'_token', response.access_token);
        localStorage.setItem(sourceReg+'_verify_code', response.device_id);
        initialize();
      } else {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录失败！',10);
      }
    });
  } else {
    let user = {};
    user.account = acc;
    user.deviceno = deviceno;
    user.pwd = md5(pwd);
    user.devicetype = 'yuj';
    user.businessplatform = 1;
    let timestamp = Date.now();
    user.signature = md5(deviceno+'|'+user.devicetype+'|'+sourcesJsonParsed[sourceReg].acc_type_login+'|'+acc+'|'+timestamp);
    user.isforce = 1;
    user.extendinfo = sourcesJsonParsed[sourceReg].extend_info;
    if (sourcesJsonParsed[sourceReg].server_version) {
      user.serverVersion = sourcesJsonParsed[sourceReg].server_version;
    }
    user.timestamp = timestamp.toString();
    user.accounttype = sourcesJsonParsed[sourceReg].acc_type_login;

    timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].login_url,user,'POST'))
    .then(response => {
      if (response.ret !== 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录失败！',10);
      } else {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录成功！',5);
        localStorage.setItem(sourceReg+'_acc', acc);
        localStorage.setItem(sourceReg+'_pwd', pwd);
        localStorage.setItem(sourceReg+'_token', response.access_token);
        localStorage.setItem(sourceReg+'_verify_code', response.device_id);
        initialize();
      }
    }).catch(err => {
      alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源!', 10);
      console.log('登录 '+sourcesJsonParsed[sourceReg].login_url+' 发生错误:', err.message);
    });
  }
}

function appendList(channel,appendSourceName,sourceLane) {
  const channelListItem = document.createElement('li');
  const channelListText = document.createTextNode(channel.chnl_name);
  if (localStorage.getItem('dark') === '1'){
    channelListItem.classList.add('white');
  }
  if (localStorage.getItem(appendSourceName+'_token') || jsonChannels.hasOwnProperty(appendSourceName)){
    channelListItem.classList.add('working');
  }
  channelListItem.setAttribute('data-id',channel.chnl_id);
  channelListItem.setAttribute('data-source',appendSourceName);
  if (channel.chnl_rate) {
    channelListItem.setAttribute('data-rate',channel.chnl_rate);
  }
  channelListItem.appendChild(channelListText);
  if (channel.chnl_cat.indexOf('高清') === -1) {
    const channelSup = document.createElement('sub');
    channelSup.textContent = sourceLane;
    channelListItem.appendChild(channelSup);
  }
  switch (channel.chnl_cat) {
    case '高清电信':
      myList1.appendChild(channelListItem);
      break;
    case '高清联通':
      myList1a.appendChild(channelListItem);
      break;
    case '标清':
      myList2.appendChild(channelListItem);
      break;
    case '央视':
      myList3.appendChild(channelListItem);
      break;
    case '卫视':
      myList4.appendChild(channelListItem);
      break;
    case '地方':
      myList5.appendChild(channelListItem);
      break;
    case '专业':
      myList8.appendChild(channelListItem);
      break;
    case '港澳台':
      myList10.appendChild(channelListItem);
      break;
    default:
      break;
  }
}

function reqJson(json) {
  timeoutPromise(5000,reqData(json))
  .then(response => {
    if (response.ret === 0) {
      response.data.forEach((source) => {
        if (source.hasOwnProperty('channels')) {
          let newChannel={};
          jsonChannels[source.name] = {};
          if (source.hasOwnProperty('overlay')) {
            jsonChannels[source.name]['overlay'] = source.overlay;
          }
          source.channels.forEach(channel => {
            if (channel.hasOwnProperty('url')) {
              jsonChannels[source.name][channel.chnl_id] = {};
              jsonChannels[source.name][channel.chnl_id]['url'] = channel.url;
              if (channel.hasOwnProperty('overlay')) {
                jsonChannels[source.name][channel.chnl_id]['overlay'] = channel.overlay;
              }
              if (channel.hasOwnProperty('schedule')) {
                jsonChannels[source.name][channel.chnl_id]['schedule'] = channel.schedule;
              }
              newChannel.chnl_name = channel.chnl_name;
              newChannel.chnl_id = channel.chnl_id;
              newChannel.chnl_cat = channel.chnl_cat;
              appendList(newChannel,source.name,source.lane);
            }
          });
        }
      });
    }
  }).catch(() => {console.log('无法连接 '+json)});
}

function getToken(source) {
  return new Promise((resolve, reject) => {
    if (source.hasOwnProperty('access_token')) {
      let deviceno;
      deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
      deviceno = deviceno + md5(deviceno).substring(7, 8);

      timeoutPromise(3000,reqData(source.login_url,'?deviceno='+deviceno+'&devicetype=3&accounttype='+source.acc_type_login+'&accesstoken=(null)&account='+source.access_token.substring(32)+'&pwd='+source.access_token.substring(0, 32)+'&isforce=1&businessplatform=1'))
      .then(response => {
        if (response.access_token) {
          localStorage.setItem(source.name+'_token', response.access_token);
          localStorage.setItem(source.name+'_verify_code', response.device_id);
          resolve(response.access_token);
        }
      }).catch(err => {reject(err);});
    } else if (localStorage.getItem(source.name+'_token')) {
      resolve(localStorage.getItem(source.name+'_token'));
    } else if (source.hasOwnProperty('refresh_token_url')) {
      let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
      deviceno = deviceno+md5(deviceno).substring(7, 8);
      timeoutPromise(3000,reqData(source.token_url,{"role":"guest","deviceno":deviceno,"deviceType":"yuj"},'POST'))
      .then(response => {
        if (response.ret === 0) {
          reqData(source.refresh_token_url,{"accessToken":response.accessToken,"refreshToken":response.refreshToken},'POST')
          .then(response => {
            if (response.ret === 0) {
              resolve(response.accessToken);
            }
          }).catch(err => {reject(err);});
        }
      }).catch(err => {reject(err);});
    } else {
      timeoutPromise(3000,reqData(source.token_url,{"usagescen":1},'POST'))
      .then(response => {
        if (response.ret === 0) {
          resolve(response.access_token);
        }
      }).catch(err => {reject(err);});
    }
  }).catch(console.log);
}

function reqChannels(source,token) {
  timeoutPromise(5000,reqData(source.list_url,'?pageidx=1&pagenum=500&accesstoken='+token))
  .then(response => {
    if (response.ret === 0) {
      let channelCats;
      let cats = {"001":"高清"+source.lane,"002":"标清","003":"央视","004":"卫视","005":"地方","008":"专业"};
      let omitArr = [];
      let reverse = 0;
      if (source.omit) {
        let omit = source.omit;
        if (omit.substring(0,7) === 'reverse') {
          reverse = 1;
          omit = omit.substring(8);
        }
        let omitChannels = omit.split(',');
        omitChannels.forEach(omitChannel => {
          if (omitChannel.indexOf('-') !== -1) {
            let omitSubArr = omitChannel.split('-');
            for (let a = Number(omitSubArr[0]); a <= Number(omitSubArr[1]); a++) {
              omitArr.push(Number(a));
            }
          } else {
            omitArr.push(Number(omitChannel));
          }
        });
      }
      response.chnl_list.forEach(channel => {
        if (source.omit) {
          let chnl_id = Number(channel.chnl_id.toString().slice(-3));
          if ((reverse === 0 && omitArr.indexOf(chnl_id) !== -1) || (reverse === 1 && omitArr.indexOf(chnl_id) === -1)) {
            return;
          }
        }
        if (channel.sub_type.length === 0) {
          if (channel.chnl_name.indexOf('高清') !== -1 || channel.chnl_name.toUpperCase().indexOf('HD') !== -1) {
            channel.sub_type = '001';
          } else {
            channel.sub_type = '002';
          }
          if (channel.chnl_name.toUpperCase().indexOf('CCTV') !== -1) {
            channel.sub_type = channel.sub_type + '|003';
          }
          if (channel.chnl_name.indexOf('卫视') !== -1) {
            channel.sub_type = channel.sub_type + '|004';
          }
        } else if (channel.chnl_name.indexOf('高清') !== -1 && channel.hasOwnProperty('subtype_name') && channel.subtype_name.indexOf('高清') === -1) {
          channel.sub_type = channel.sub_type + '|001';
        }
        let newChannel={};
        channelCats = channel.sub_type.split('|');
        channelCats.forEach(channelCat => {
          channelCat = channelCat.slice(-3);
          if (sourcesJsonParsed[source.name].hasOwnProperty('fix_cats') && sourcesJsonParsed[source.name].fix_cats.hasOwnProperty(channelCat)) {
            channelCat = sourcesJsonParsed[source.name].fix_cats[channelCat];
          }
          if (typeof cats[channelCat] === 'undefined') {
            return;
          }
          newChannel.chnl_name = channel.chnl_name;
          newChannel.chnl_id = channel.chnl_id;
          newChannel.chnl_rate = channel.rate_list[0];
          for (let index = 0; index < channel.rate_list.length; index++) {
            const channel_rate = channel.rate_list[index];
            if (channel_rate === 'org') {
              newChannel.chnl_rate = channel_rate;
              break;
            } else if (channel_rate === 'hd') {
              newChannel.chnl_rate = channel_rate;
            }
          }
          newChannel.chnl_cat = cats[channelCat];
          appendList(newChannel,source.name,source.lane);
        });
      });
    } else {
      alertInfo(sourcesJsonParsed[source.name].desc+'直播源错误！需重新注册或登录！',10);
      localStorage.removeItem(source.name+'_acc');
      localStorage.removeItem(source.name+'_pwd');
      localStorage.removeItem(source.name+'_token');
    }
  }).catch(err => {
    toggleClass('[data-source='+source.name+']','hidden');
    alertInfo('无法连接'+sourcesJsonParsed[source.name].desc+'直播源！',10);
    console.log('获取列表 '+source.list_url+' 发生错误:', err.message);
  });
}

function reqAuth() {
  timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].auth_info_url,'?accesstoken='+localStorage.getItem(sourceReg+'_token')+'&programid='+programId+'&playtype=live&protocol=hls&verifycode='+localStorage.getItem(sourceReg+'_verify_code')))
  .then(response => {
    if (response.ret === 0) {
      let authtoken = md5('ipanel123#%#&*(&(*#*&^*@#&*%()#*()$)#@&%(*@#()*%321ipanel'+response.auth_random_sn);
      let playtoken = response.play_token;
      timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].auth_verify_url,'?programid='+programId+'&playtype=live&protocol=hls&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&verifycode='+localStorage.getItem(sourceReg+'_verify_code')+'&authtoken='+authtoken))
      .then(response => {
        if (response.ret !== 0) {
          console.log(sourcesJsonParsed[sourceReg].auth_verify_url+' 返回错误');
        }
        if (sourcesJsonParsed[sourceReg].hasOwnProperty('protocol') && sourcesJsonParsed[sourceReg].protocol) {
          protocol = sourcesJsonParsed[sourceReg].protocol;
        } else {
          protocol = 'hls';
        }
        if (localStorage.getItem(sourceReg+'_verify_code')) {
          hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol='+protocol+'&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&playtoken='+playtoken+'&verifycode='+localStorage.getItem(sourceReg+'_verify_code')+'&rate='+rate+'&programid='+programId+'.m3u8';
        } else {
          hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol='+protocol+'&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&playtoken='+playtoken+'&rate='+rate+'&programid='+programId+'.m3u8';
        }
        if (protocol === 'http') {
          tsLoad();
        } else {
          videojsLoad();
        }
        showSchedule();
        updateAside();
      }).catch(err => {
        alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源！',10);
        console.log('请求 '+sourcesJsonParsed[sourceReg].auth_verify_url+' 发生错误:', err.message);
        updateAside();
      });
    } else {
      alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源错误！需重新注册或登录！',10);
      localStorage.removeItem(sourceReg+'_acc');
      localStorage.removeItem(sourceReg+'_pwd');
      localStorage.removeItem(sourceReg+'_token');
      localStorage.removeItem(sourceReg+'_verify_code');
      updateAside();
    }
  }).catch(err => {
    alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源！',10);
    console.log('请求 '+sourcesJsonParsed[sourceReg].auth_info_url+' 发生错误:', err.message);
    updateAside();
  });
}

function parseJson(json) {
  let newJson = {};
  json.data.forEach(element => {
    if (element.play_url) {
      const sourcesListItem = document.createElement('li');
      sourcesListItem.textContent = element.desc;
      sourcesListItem.className = 'source_' + element.name;
      if (localStorage.getItem('dark') === '1'){
        sourcesListItem.classList.add('white');
      }
      sourcesField.appendChild(sourcesListItem);
      const entries = Object.entries(element);
      for (const [key, value] of entries) {
        if (key.indexOf('_url') !== -1) {
          urls.push(value);
        }
      }
    }

    let newIndex = element.name;
    newJson[newIndex] = element;
  });

  if (!sourcesField.firstChild) {
    sourcesField.textContent = '无';
  }
  sourcesJsonParsed = newJson;
}

function updateAside() {
  const selected = document.querySelector('.sourceReg');
  if(selected) selected.classList.remove('sourceReg');
  const foundSource = document.querySelector('.source_'+sourceReg);
  if(foundSource) {
    foundSource.classList.add('sourceReg');
    if (sourcesJsonParsed[sourceReg].hasOwnProperty('access_token')) {
      fieldsetLoginForm.setAttribute("disabled","disabled");
      fieldsetRegForm.setAttribute("disabled","disabled");
      formToggle.disabled = true;
      return;
    } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('play_url')) {
      sourceReg = sourceRegDefault;
      loginAccField.setAttribute('placeholder','用户名');
      regAccField.setAttribute('placeholder','用户名');
    } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
      loginAccField.setAttribute('placeholder','用户名');
      regAccField.setAttribute('placeholder','用户名');
      regImgField.classList.toggle('hidden',true);
      regImgInputField.classList.toggle('hidden',true);
      regSmsField.classList.toggle('hidden',true);
    } else {
      loginAccField.setAttribute('placeholder','手机号');
      regAccField.setAttribute('placeholder','手机号');
      regImgField.classList.toggle('hidden',false);
      regImgInputField.classList.toggle('hidden',false);
      regSmsField.classList.toggle('hidden',false);
    }
    fieldsetLoginForm.removeAttribute("disabled");
    fieldsetRegForm.removeAttribute("disabled");
    formToggle.disabled = false;
    loginAccField.value = localStorage.getItem(sourceReg+'_acc');
    loginPwdField.value = localStorage.getItem(sourceReg+'_pwd');
  }
}

function resetSourceReg() {
  sourceReg = sourceRegDefault;
  programId = undefined;
  updateAside();
}

function showSchedule(chnl) {
  deleteSchedule();

  if (!chnl) {
    if (!sourcesJsonParsed[sourceReg].hasOwnProperty('schedule_url')) {
      return;
    } else if (schedules[sourceReg] && schedules[sourceReg][programId]) {
      insertSchedule(sourceReg,programId);
    } else {
      let starttime = new Date();
      starttime = starttime.setHours(0,0,0,0) / 1000;
      let endtime = starttime + 86400;
      let chnlSource = sourceReg;
      let chnlId = programId;
      reqData(sourcesJsonParsed[chnlSource].schedule_url,'?accesstoken='+localStorage.getItem(sourceReg+'_token')+'&repeat=1&starttime='+starttime+'&endtime='+endtime+'&chnlid='+chnlId+'&pagenum=500&pageidx=1')
      .then(response => {
        if (!schedules.hasOwnProperty(chnlSource)) {
          schedules[chnlSource] = {};
        }
        schedules[chnlSource][chnlId] = [];
        for (let index = 0; index < response.total; index++) {
          let newEvent = {},newEventTime;
          const event = response.event_list[index];
          newEvent.event_id = event.event_id;
          newEvent.title = event.event_name;
          newEventTime = new Date(event.start_time * 1000);
          newEventTime = newEventTime.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
          newEvent.time = newEventTime.replace(' ','');
          newEvent.sys_time = event.start_time.toString();
          schedules[chnlSource][chnlId].push(newEvent);
        }
        if (schedules[chnlSource][chnlId].length > 0) {
          insertSchedule(chnlSource,chnlId);
        }
      });
    }
  } else if (Object.keys(schedules).length === 0 && schedules.constructor === Object) {
    reqData(scheduleJson)
    .then(response => {
      schedules = response;
      insertSchedule(chnl);
    });
  } else {
    insertSchedule(chnl);
  }
}

function insertSchedule(chnl,chnlId) {
  if (!schedules.hasOwnProperty(chnl)) {
    sliderField.classList.add('hidden');
    return;
  }

  let chnlSchedules;

  if (chnlId) {
    if (!schedules[chnl].hasOwnProperty(chnlId) || schedules[chnl][chnlId].length === 0) {
      sliderField.classList.add('hidden');
      return;
    }
    chnlSchedules = schedules[chnl][chnlId];
  }
  else if (schedules[chnl].length === 0) {
    sliderField.classList.add('hidden');
    return;
  } else {
    chnlSchedules = schedules[chnl];
  }

  let scheduleTime = 1000000000,indexTime,slideIndex = 0;
  let dateNow = Date.now();

  for (let index = 0; index < chnlSchedules.length; index++) {
    const schedule = chnlSchedules[index];
    const scheduleListItem = document.createElement('li');
    const scheduleListText = document.createTextNode(schedule.time + ' ' + schedule.title);
    scheduleListItem.classList.add('js_slide');
    if (schedule.hasOwnProperty('id')) {
      scheduleListItem.setAttribute('data-id', schedule.id);
      scheduleListItem.setAttribute('data-channel', chnl);
    }
    if (schedule.hasOwnProperty('event_id')) {
      scheduleListItem.setAttribute('data-eventid', schedule.event_id);
      scheduleListItem.setAttribute('data-id', chnl);
    }
    scheduleListItem.appendChild(scheduleListText);
    scheduleField.appendChild(scheduleListItem);
    indexTime = schedule.sys_time * 1000;
    if (indexTime < dateNow && indexTime > scheduleTime) {
      scheduleTime = indexTime;
      slideIndex = index;
    }
  }

  sliderField.classList.remove('hidden');

  lory(sliderField, {
    initialIndex: slideIndex,
    centerMode: { enableCenterMode: true, firstSlideLeftAlign: true }
  });
}

function deleteSchedule() {
  sliderField.classList.add('hidden');
  while (scheduleField.firstChild) {
    scheduleField.removeChild(scheduleField.firstChild);
  }
}

function playBack(sourceName) {
  reqData(sourcesJsonParsed[sourceName].event_info_url,'?accesstoken='+localStorage.getItem(sourceName+'_token')+'&eventid='+eventId)
  .then(response => {
    if (response.ret === 0) {
      let idx = response.event_idx;
      let startTime = response.start_time;
      let endTime = response.end_time;
      let playToken = response.play_token;
      let playbackUrl;

      if (response.demand_url[0]) {
        if (sourcesJsonParsed[sourceName].hasOwnProperty('playback_url')) {
          playbackUrl = sourcesJsonParsed[sourceName].playback_url;
        } else {
          playbackUrl = response.demand_url[0];
        }
      }

      if (playbackUrl) {
        let eventStartTime = new Date(startTime * 1000);
        let eventStartTimeHours = eventStartTime.getHours();
        if (eventStartTimeHours < 10) {
          eventStartTimeHours = '0' + eventStartTimeHours;
        }
        let eventStartTimeMinutes = eventStartTime.getMinutes();
        if (eventStartTimeMinutes < 10) {
          eventStartTimeMinutes = '0' + eventStartTimeMinutes;
        }
        let eventStartTimeMilliseconds = eventStartTime.getMilliseconds();
        if (eventStartTimeMilliseconds < 10) {
          eventStartTimeMilliseconds = '0' + eventStartTimeMilliseconds;
        }
        startTime = idx + eventStartTimeHours + eventStartTimeMinutes + eventStartTimeMilliseconds;

        let eventEndTime = new Date(endTime * 1000);
        let eventEndTimeHours = eventEndTime.getHours();
        if (eventEndTimeHours < 10) {
          eventEndTimeHours = '0' + eventEndTimeHours;
        }
        let eventEndTimeMinutes = eventEndTime.getMinutes();
        if (eventEndTimeMinutes < 10) {
          eventEndTimeMinutes = '0' + eventEndTimeMinutes;
        }
        let eventEndTimeMilliseconds = eventEndTime.getMilliseconds();
        if (eventEndTimeMilliseconds < 10) {
          eventEndTimeMilliseconds = '0' + eventEndTimeMilliseconds;
        }
        endTime = idx + eventEndTimeHours + eventEndTimeMinutes + eventEndTimeMilliseconds;
        if (localStorage.getItem(sourceName+'_verify_code')) {
          hlsVideoUrl = playbackUrl+'?playtype=lookback&protocol=hls&starttime='+startTime+'&endtime='+endTime+'&accesstoken='+localStorage.getItem(sourceName+'_token')+'&playtoken='+playToken+'&verifycode='+localStorage.getItem(sourceName+'_verify_code')+'&rate='+rate+'&programid='+eventId+'.m3u8';
        } else {
          hlsVideoUrl = playbackUrl+'?playtype=lookback&protocol=hls&starttime='+startTime+'&endtime='+endTime+'&accesstoken='+localStorage.getItem(sourceName+'_token')+'&playtoken='+playToken+'&rate='+rate+'&programid='+eventId+'.m3u8';
        }
        videojsLoad();
      } else {
        alertInfo('录像还未准备好！', 10);
      }
    }
  });
}

function playbackOrUpcoming(e) {
  if(e.target && e.target.nodeName === "LI") {
    if (e.target.hasAttribute('data-eventid')) {
      rate = 'org';
      eventId = e.target.dataset.eventid;
      let sourceName = e.target.dataset.id;
      playBack(sourceName);
    } else if (e.target.hasAttribute('data-id')) {
      let showId =  e.target.dataset.id;
      let channel = e.target.dataset.channel;
      let hboLink;
      if (channel === "hbo") {
        hboLink = 'https://hboasia.com/HBO/zh-cn/ajax/home_schedule_upcoming_showtimes?channel=' + channel + '&feed=cn&id=' + showId;
      } else {
        hboLink = 'https://hboasia.com/HBO/zh-tw/ajax/home_schedule_upcoming_showtimes?channel=' + channel + '&feed=satellite&id=' + showId;
      }
      //alertInfo('正在查询官网请稍等...');
      reqData(hboLink)
      .then(response => {
        let dateNow = Date.now();
        const upComingList = document.createElement('ul');
        upComingList.setAttribute('data-id', dateNow);
        const upComingListTitle = document.createTextNode('即將播出:');
        for (let index = 0; index < response.length; index++) {
          const schedule = response[index];
          if (schedule.id) {
            const upComingListItem = document.createElement('li');
            const upComingListText = document.createTextNode(schedule.time);
            upComingListItem.appendChild(upComingListText);
            upComingList.appendChild(upComingListItem);
          }
        }
        if (!upComingList.firstChild) {
          const upComingListItem = document.createElement('li');
          const upComingListText = document.createTextNode('无');
          upComingListItem.appendChild(upComingListText);
          upComingList.appendChild(upComingListItem);
        }
        while (upComingField.firstChild) {
          upComingField.removeChild(upComingField.firstChild);
        }
        upComingField.appendChild(upComingListTitle);
        upComingField.appendChild(upComingList);
        setTimeout(function() {
          if (upComingField.firstChild && upComingField.firstChild.nextSibling.dataset.id === dateNow.toString()) {
            while (upComingField.firstChild) {
              upComingField.removeChild(upComingField.firstChild);
            }
          }
        }, 10000);
      });
    }
  }
}

function switchLink() {
  hlsVideoUrl = linkInputField.value;
  if (hlsVideoUrl.indexOf('.flv') !== -1 || hlsVideoUrl.indexOf('.m3u8') !== -1) {
    videojsLoad();
    deleteSchedule();
  }
}

let programId,rate,eventId,hlsVideoUrl,protocol,urls = [],sourcesJson,sourcesJsonParsed,jsonChannels = {},schedules = {},overlaysInfo = {};
let sourceReg = 'hrtn',sourceRegDefault = 'hrtn';
let localJson = 'channels.json';
let remoteJson = 'http://hbo.epub.fun/channels.json';
let scheduleJson = 'http://hbo.epub.fun/schedule.json';
const videoField = document.querySelector('.videoContainer');
const sourcesField = document.querySelector('.sources');
const fieldsetLoginForm = document.querySelector('.loginForm fieldset');
const loginForm = document.querySelector('.loginForm');
const loginAccField = document.querySelector('.loginAcc');
const loginPwdField = document.querySelector('.loginPwd');
const loginBtn = document.querySelector('.loginBtn');
const fieldsetRegForm = document.querySelector('.regForm fieldset');
const regForm = document.querySelector('.regForm');
const regAccField = document.querySelector('.regAcc');
const regPwdField = document.querySelector('.regPwd');
const regImgField = document.querySelector('.regImg');
const regImgInputField = document.querySelector('.regImgInput');
const regImgIdField = document.querySelector('.regImgId');
const regSmsField = document.querySelector('.regSms');
const regBtn = document.querySelector('.regBtn');
const formToggle = document.querySelector('.formToggle');
const channelsField = document.querySelector('.channels');
const categoriesField = document.querySelector('.categories');
const featureBtn = document.querySelector('.categories ul li:nth-child(1)');
const switchBtn = document.querySelector('.switch');
const myList1 = document.querySelector('.channels ul:nth-child(1)');
const myList1a = document.querySelector('.channels ul:nth-child(2)');
const myList2 = document.querySelector('.channels ul:nth-child(3)');
const myList3 = document.querySelector('.channels ul:nth-child(4)');
const myList4 = document.querySelector('.channels ul:nth-child(5)');
const myList5 = document.querySelector('.channels ul:nth-child(6)');
const myList8 = document.querySelector('.channels ul:nth-child(7)');
const myList9 = document.querySelector('.channels ul:nth-child(8)');
const myList10 = document.querySelector('.channels ul:nth-child(9)');
const linkInputField = document.querySelector('.linkInput');
const alertField = document.querySelector('.alert');
const upComingField = document.querySelector('.upComing');
const sliderField = document.querySelector('.js_slider');
const scheduleField = document.querySelector('.slides');

let liveui = true;
if (videojs.browser.IS_ANDROID || videojs.browser.IS_IOS) {
  liveui = false;
}

reqData(localJson).then(response => {
  if (response.ret === 0) {
    sourcesJson = response;
    parseJson(response);
    initialize();
  } else {
    alertInfo('服务器维护中，请稍后再试！',10);
  }
}).catch(() => {
  console.log('本地频道不存在，尝试连接远程频道...');
  reqData(remoteJson).then(response => {
    if (response.ret === 0) {
      sourcesJson = response;
      parseJson(response);
      initialize();
    } else {
      alertInfo('官网服务器维护中，请稍后再试！',10);
    }
  }).catch(err => {
    console.log('初始化错误:',err.message);
  });
});

function initialize() {
  myList1.textContent = '';
  myList1.classList.add('myList1');
  myList1a.textContent = '';
  myList1a.classList.add('myList1a');
  myList1a.classList.add('hidden');
  myList2.textContent = '';
  myList2.classList.add('myList2');
  myList2.classList.add('hidden');
  myList3.textContent = '';
  myList3.classList.add('myList3');
  myList3.classList.add('hidden');
  myList4.textContent = '';
  myList4.classList.add('myList4');
  myList4.classList.add('hidden');
  myList5.textContent = '';
  myList5.classList.add('myList5');
  myList5.classList.add('hidden');
  myList8.textContent = '';
  myList8.classList.add('myList8');
  myList8.classList.add('hidden');
  myList9.classList.add('myList9');
  myList9.classList.add('hidden');
  myList10.textContent = '';
  myList10.classList.add('myList10');
  myList10.classList.add('hidden');

  sourcesJson.data.forEach(source => {
    if (source.hasOwnProperty('json')) {
      reqJson(source.json);
    }
    if (source.hasOwnProperty('list_url')) {
      getToken(source).then(response => {reqChannels(source,response);});
    }
    if (source.hasOwnProperty('channels')) {
      source.channels.forEach(channel => {
        if (channel.hasOwnProperty('chnl_cat')) {
          appendList(channel,source.name,source.lane);
        }
      });
    }
  });

  if (localStorage.getItem(sourceReg+'_acc') && localStorage.getItem(sourceReg+'_pwd')){
    loginAccField.value = localStorage.getItem(sourceReg+'_acc');
    loginPwdField.value = localStorage.getItem(sourceReg+'_pwd');
  }

  updateAside();
  playVideo();
}

formToggle.addEventListener("click", function(e) {
  e.preventDefault();
  loginForm.classList.toggle('hidden');
  regForm.classList.toggle('hidden');
  if (formToggle.textContent === '注册') {
    formToggle.textContent = '登录';
  } else {
    formToggle.textContent = '注册';
  }
});

regAccField.addEventListener("change", uniqueName);
regAccField.addEventListener("change", regImg);
regImgField.addEventListener("click", regImg);
regImgInputField.addEventListener("change", reqSms);
regBtn.addEventListener("click", reqReg);
loginBtn.addEventListener("click", reqLogin);
sourcesField.addEventListener("click", switchSource);
categoriesField.addEventListener("click", switchCategory);
scheduleField.addEventListener("click", playbackOrUpcoming);
channelsField.addEventListener("click", switchChannel);
linkInputField.addEventListener("change", switchLink);
document.addEventListener("fullscreenchange", setOverlayFullscreen);
document.addEventListener("webkitfullscreenchange", setOverlayFullscreen);
document.addEventListener("mozfullscreenchange", setOverlayFullscreen);
document.addEventListener("msfullscreenchange", setOverlayFullscreen);
window.addEventListener("orientationchange", setOverlayFullscreen);

if (localStorage.getItem('dark') === '1'){
  switchBtn.click();
}
  </script>
</body>
</html>